!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self)["browser-image-manipulation"]=t()}(this,(function(){"use strict";function e(){throw new Error("Dynamic requires are not currently supported by rollup-plugin-commonjs")}function t(e,t){return e(t={exports:{}},t.exports),t.exports}var n=t((function(e){var t=function(e){var t,n=Object.prototype,i=n.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},r=a.iterator||"@@iterator",o=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function l(e,t,n,i){var a=t&&t.prototype instanceof m?t:m,r=Object.create(a.prototype),o=new _(i||[]);return r._invoke=function(e,t,n){var i=h;return function(a,r){if(i===c)throw new Error("Generator is already running");if(i===f){if("throw"===a)throw r;return P()}for(n.method=a,n.arg=r;1;){var o=n.delegate;if(o){var s=E(o,n);if(s){if(s===g)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===h)throw i=f,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=c;var l=A(e,t,n);if("normal"===l.type){if(i=n.done?f:u,l.arg===g)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i=f,n.method="throw",n.arg=l.arg)}}}(e,n,o),r}function A(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var h="suspendedStart",u="suspendedYield",c="executing",f="completed",g={};function m(){}function p(){}function d(){}var y={};y[r]=function(){return this};var v=Object.getPrototypeOf,I=v&&v(v(Q([])));I&&I!==n&&i.call(I,r)&&(y=I);var w=d.prototype=m.prototype=Object.create(y);function C(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function B(e){var t;this._invoke=function(n,a){function r(){return new Promise((function(t,r){!function t(n,a,r,o){var s=A(e[n],e,a);if("throw"!==s.type){var l=s.arg,h=l.value;return h&&"object"==typeof h&&i.call(h,"__await")?Promise.resolve(h.__await).then((function(e){t("next",e,r,o)}),(function(e){t("throw",e,r,o)})):Promise.resolve(h).then((function(e){l.value=e,r(l)}),(function(e){return t("throw",e,r,o)}))}o(s.arg)}(n,a,t,r)}))}return t=t?t.then(r,r):r()}}function E(e,n){var i=e.iterator[n.method];if(i===t){if(n.delegate=null,"throw"===n.method){if(e.iterator["return"]&&(n.method="return",n.arg=t,E(e,n),"throw"===n.method))return g;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return g}var a=A(i,e.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,g;var r=a.arg;return r?r.done?(n[e.resultName]=r.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,g):r:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function b(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function _(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function Q(e){if(e){var n=e[r];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var a=-1,o=function n(){for(;++a<e.length;)if(i.call(e,a))return n.value=e[a],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}return{next:P}}function P(){return{value:t,done:!0}}return p.prototype=w.constructor=d,d.constructor=p,d[s]=p.displayName="GeneratorFunction",e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,s in e||(e[s]="GeneratorFunction")),e.prototype=Object.create(w),e},e.awrap=function(e){return{__await:e}},C(B.prototype),B.prototype[o]=function(){return this},e.AsyncIterator=B,e.async=function(t,n,i,a){var r=new B(l(t,n,i,a));return e.isGeneratorFunction(n)?r:r.next().then((function(e){return e.done?e.value:r.next()}))},C(w),w[s]="Generator",w[r]=function(){return this},w.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var i=t.pop();if(i in e)return n.value=i,n.done=!1,n}return n.done=!0,n}},e.values=Q,_.prototype={constructor:_,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(b),!e)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function a(i,a){return s.type="throw",s.arg=e,n.next=i,a&&(n.method="next",n.arg=t),!!a}for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r],s=o.completion;if("root"===o.tryLoc)return a("end");if(o.tryLoc<=this.prev){var l=i.call(o,"catchLoc"),A=i.call(o,"finallyLoc");if(l&&A){if(this.prev<o.catchLoc)return a(o.catchLoc,!0);if(this.prev<o.finallyLoc)return a(o.finallyLoc)}else if(l){if(this.prev<o.catchLoc)return a(o.catchLoc,!0)}else{if(!A)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return a(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&i.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var r=a;break}}r&&("break"===e||"continue"===e)&&r.tryLoc<=t&&t<=r.finallyLoc&&(r=null);var o=r?r.completion:{};return o.type=e,o.arg=t,r?(this.method="next",this.next=r.finallyLoc,g):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),b(n),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var a=i.arg;b(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,i){return this.delegate={iterator:Q(e),resultName:n,nextLoc:i},"next"===this.method&&(this.arg=t),g}},e}(e.exports);try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}}));function i(e,t,n,i,a,r,o){try{var s=e[r](o),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(i,a)}var a=function(e){return function(){var t=this,n=arguments;return new Promise((function(a,r){var o=e.apply(t,n);function s(e){i(o,a,r,s,l,"next",e)}function l(e){i(o,a,r,s,l,"throw",e)}s(void 0)}))}};var r=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")};function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var s=function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e},l=t((function(e,t){!function(){var n={};function i(e){return u(">"+f("B",e.length),e)}function a(e){return u(">"+f("H",e.length),e)}function r(e){return u(">"+f("L",e.length),e)}function o(e,t,n){var o,s,l,A,h="",c="";if("Byte"==t)(o=e.length)<=4?c=i(e)+f("\0",4-o):(c=u(">L",[n]),h=i(e));else if("Short"==t)(o=e.length)<=2?c=a(e)+f("\0\0",2-o):(c=u(">L",[n]),h=a(e));else if("Long"==t)(o=e.length)<=1?c=r(e):(c=u(">L",[n]),h=r(e));else if("Ascii"==t)(o=(s=e+"\0").length)>4?(c=u(">L",[n]),h=s):c=s+f("\0",4-o);else if("Rational"==t){if("number"==typeof e[0])o=1,l=e[0],A=e[1],s=u(">L",[l])+u(">L",[A]);else{o=e.length,s="";for(var g=0;g<o;g++)l=e[g][0],A=e[g][1],s+=u(">L",[l])+u(">L",[A])}c=u(">L",[n]),h=s}else if("SRational"==t){if("number"==typeof e[0])o=1,l=e[0],A=e[1],s=u(">l",[l])+u(">l",[A]);else{o=e.length,s="";for(g=0;g<o;g++)l=e[g][0],A=e[g][1],s+=u(">l",[l])+u(">l",[A])}c=u(">L",[n]),h=s}else"Undefined"==t&&((o=e.length)>4?(c=u(">L",[n]),h=e):c=e+f("\0",4-o));return[u(">L",[o]),c,h]}function s(e,t,n){var i,a=8,r=Object.keys(e).length,s=u(">H",[r]);i=["0th","1st"].indexOf(t)>-1?2+12*r+4:2+12*r;var l="",A="";for(var h in e)if("string"==typeof h&&(h=parseInt(h)),!("0th"==t&&[34665,34853].indexOf(h)>-1||"Exif"==t&&40965==h||"1st"==t&&[513,514].indexOf(h)>-1)){var c=e[h],f=u(">H",[h]),g=p[t][h]["type"],d=u(">H",[m[g]]);"number"==typeof c&&(c=[c]);var y=o(c,g,a+i+n+A.length);l+=f+d+y[0]+y[1],A+=y[2]}return[s+l,A]}function l(e){var t;if("ÿØ"==e.slice(0,2))t=function(e){for(var t,n=0;n<e.length;n++)if("ÿá"==(t=e[n]).slice(0,2)&&"Exif\0\0"==t.slice(4,10))return t;return null}(g(e)),this.tiftag=t?t.slice(10):null;else if(["II","MM"].indexOf(e.slice(0,2))>-1)this.tiftag=e;else{if("Exif"!=e.slice(0,4))throw new Error("Given file is neither JPEG nor TIFF.");this.tiftag=e.slice(6)}}if(n.version="1.0.4",n.remove=function(e){var t=!1;if("ÿØ"==e.slice(0,2));else{if("data:image/jpeg;base64,"!=e.slice(0,23)&&"data:image/jpg;base64,"!=e.slice(0,22))throw new Error("Given data is not jpeg.");e=h(e.split(",")[1]),t=!0}var n=g(e).filter((function(e){return!("ÿá"==e.slice(0,2)&&"Exif\0\0"==e.slice(4,10))})).join("");return t&&(n="data:image/jpeg;base64,"+A(n)),n},n.insert=function(e,t){var n=!1;if("Exif\0\0"!=e.slice(0,6))throw new Error("Given data is not exif.");if("ÿØ"==t.slice(0,2));else{if("data:image/jpeg;base64,"!=t.slice(0,23)&&"data:image/jpg;base64,"!=t.slice(0,22))throw new Error("Given data is not jpeg.");t=h(t.split(",")[1]),n=!0}var i="ÿá"+u(">H",[e.length+2])+e,a=function(e,t){var n=!1,i=[];e.forEach((function(a,r){"ÿá"==a.slice(0,2)&&"Exif\0\0"==a.slice(4,10)&&(n?i.unshift(r):(e[r]=t,n=!0))})),i.forEach((function(t){e.splice(t,1)})),!n&&t&&(e=[e[0],t].concat(e.slice(1)));return e.join("")}(g(t),i);return n&&(a="data:image/jpeg;base64,"+A(a)),a},n.load=function(e){var t;if("string"!=typeof e)throw new Error("'load' gots invalid type argument.");if("ÿØ"==e.slice(0,2))t=e;else if("data:image/jpeg;base64,"==e.slice(0,23)||"data:image/jpg;base64,"==e.slice(0,22))t=h(e.split(",")[1]);else{if("Exif"!=e.slice(0,4))throw new Error("'load' gots invalid file data.");t=e.slice(6)}var n={"0th":{},Exif:{},GPS:{},Interop:{},"1st":{},thumbnail:null},i=new l(t);if(null===i.tiftag)return n;"II"==i.tiftag.slice(0,2)?i.endian_mark="<":i.endian_mark=">";var a=c(i.endian_mark+"L",i.tiftag.slice(4,8))[0];n["0th"]=i.get_ifd(a,"0th");var r=n["0th"]["first_ifd_pointer"];if(delete n["0th"]["first_ifd_pointer"],34665 in n["0th"]&&(a=n["0th"][34665],n["Exif"]=i.get_ifd(a,"Exif")),34853 in n["0th"]&&(a=n["0th"][34853],n["GPS"]=i.get_ifd(a,"GPS")),40965 in n["Exif"]&&(a=n["Exif"][40965],n["Interop"]=i.get_ifd(a,"Interop")),"\0\0\0\0"!=r&&(a=c(i.endian_mark+"L",r)[0],n["1st"]=i.get_ifd(a,"1st"),513 in n["1st"]&&514 in n["1st"])){var o=n["1st"][513]+n["1st"][514],s=i.tiftag.slice(n["1st"][513],o);n["thumbnail"]=s}return n},n.dump=function(e){var t,i,a,r,o,l,A=8,h=(t=e,JSON.parse(JSON.stringify(t))),c=!1,f=!1,p=!1,d=!1;i="0th"in h?h["0th"]:{},"Exif"in h&&Object.keys(h["Exif"]).length||"Interop"in h&&Object.keys(h["Interop"]).length?(i[34665]=1,c=!0,a=h["Exif"],"Interop"in h&&Object.keys(h["Interop"]).length?(a[40965]=1,p=!0,r=h["Interop"]):Object.keys(a).indexOf(n.ExifIFD.InteroperabilityTag.toString())>-1&&delete a[40965]):Object.keys(i).indexOf(n.ImageIFD.ExifTag.toString())>-1&&delete i[34665],"GPS"in h&&Object.keys(h["GPS"]).length?(i[n.ImageIFD.GPSTag]=1,f=!0,o=h["GPS"]):Object.keys(i).indexOf(n.ImageIFD.GPSTag.toString())>-1&&delete i[n.ImageIFD.GPSTag],"1st"in h&&"thumbnail"in h&&null!=h["thumbnail"]&&(d=!0,h["1st"][513]=1,h["1st"][514]=1,l=h["1st"]);var y,v,I,w=s(i,"0th",0),C=w[0].length+12*c+12*f+4+w[1].length,B="",E=0,S="",b=0,_="",Q=0,P="";(c&&(E=(y=s(a,"Exif",C))[0].length+12*p+y[1].length),f&&(b=(S=s(o,"GPS",C+E).join("")).length),p)&&(Q=(_=s(r,"Interop",C+E+b).join("")).length);if(d&&(v=s(l,"1st",C+E+b+Q),(I=function(e){var t=g(e);for(;"ÿà"<=t[1].slice(0,2)&&t[1].slice(0,2)<="ÿï";)t=[t[0]].concat(t.slice(2));return t.join("")}(h["thumbnail"])).length>64e3))throw new Error("Given thumbnail is too large. max 64kB");var x="",R="",k="",D="\0\0\0\0";if(c){var L=u(">L",[M=A+C]);x=u(">H",[34665])+u(">H",[m["Long"]])+u(">L",[1])+L}if(f){L=u(">L",[M=A+C+E]);R=u(">H",[34853])+u(">H",[m["Long"]])+u(">L",[1])+L}if(p){L=u(">L",[M=A+C+E+b]);k=u(">H",[40965])+u(">H",[m["Long"]])+u(">L",[1])+L}if(d){var M;D=u(">L",[M=A+C+E+b+Q]);var G="\0\0\0\0"+u(">L",[M+v[0].length+24+4+v[1].length]),T="\0\0\0\0"+u(">L",[I.length]);P=v[0]+G+T+"\0\0\0\0"+v[1]+I}var F=w[0]+x+R+D+w[1];return c&&(B=y[0]+k+y[1]),"Exif\0\0MM\0*\0\0\0\b"+F+B+S+_+P},l.prototype={get_ifd:function(e,t){var n,i={},a=c(this.endian_mark+"H",this.tiftag.slice(e,e+2))[0],r=e+2;n=["0th","1st"].indexOf(t)>-1?"Image":t;for(var o=0;o<a;o++){e=r+12*o;var s=c(this.endian_mark+"H",this.tiftag.slice(e,e+2))[0],l=[c(this.endian_mark+"H",this.tiftag.slice(e+2,e+4))[0],c(this.endian_mark+"L",this.tiftag.slice(e+4,e+8))[0],this.tiftag.slice(e+8,e+12)];s in p[n]&&(i[s]=this.convert_value(l))}return"0th"==t&&(e=r+12*a,i["first_ifd_pointer"]=this.tiftag.slice(e,e+4)),i},convert_value:function(e){var t,n=null,i=e[0],a=e[1],r=e[2];if(1==i)a>4?(t=c(this.endian_mark+"L",r)[0],n=c(this.endian_mark+f("B",a),this.tiftag.slice(t,t+a))):n=c(this.endian_mark+f("B",a),r.slice(0,a));else if(2==i)a>4?(t=c(this.endian_mark+"L",r)[0],n=this.tiftag.slice(t,t+a-1)):n=r.slice(0,a-1);else if(3==i)a>2?(t=c(this.endian_mark+"L",r)[0],n=c(this.endian_mark+f("H",a),this.tiftag.slice(t,t+2*a))):n=c(this.endian_mark+f("H",a),r.slice(0,2*a));else if(4==i)a>1?(t=c(this.endian_mark+"L",r)[0],n=c(this.endian_mark+f("L",a),this.tiftag.slice(t,t+4*a))):n=c(this.endian_mark+f("L",a),r);else if(5==i)if(t=c(this.endian_mark+"L",r)[0],a>1){n=[];for(var o=0;o<a;o++)n.push([c(this.endian_mark+"L",this.tiftag.slice(t+8*o,t+4+8*o))[0],c(this.endian_mark+"L",this.tiftag.slice(t+4+8*o,t+8+8*o))[0]])}else n=[c(this.endian_mark+"L",this.tiftag.slice(t,t+4))[0],c(this.endian_mark+"L",this.tiftag.slice(t+4,t+8))[0]];else if(7==i)a>4?(t=c(this.endian_mark+"L",r)[0],n=this.tiftag.slice(t,t+a)):n=r.slice(0,a);else if(9==i)a>1?(t=c(this.endian_mark+"L",r)[0],n=c(this.endian_mark+f("l",a),this.tiftag.slice(t,t+4*a))):n=c(this.endian_mark+f("l",a),r);else{if(10!=i)throw new Error("Exif might be wrong. Got incorrect value "+"type to decode. type:"+i);if(t=c(this.endian_mark+"L",r)[0],a>1){n=[];for(o=0;o<a;o++)n.push([c(this.endian_mark+"l",this.tiftag.slice(t+8*o,t+4+8*o))[0],c(this.endian_mark+"l",this.tiftag.slice(t+4+8*o,t+8+8*o))[0]])}else n=[c(this.endian_mark+"l",this.tiftag.slice(t,t+4))[0],c(this.endian_mark+"l",this.tiftag.slice(t+4,t+8))[0]]}return n instanceof Array&&1==n.length?n[0]:n}},"undefined"!=typeof window&&"function"==typeof window.btoa)var A=window.btoa;if(void 0===A)A=function(e){for(var t,n,i,a,r,o,s,l="",A=0,h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";A<e.length;)a=(t=e.charCodeAt(A++))>>2,r=(3&t)<<4|(n=e.charCodeAt(A++))>>4,o=(15&n)<<2|(i=e.charCodeAt(A++))>>6,s=63&i,isNaN(n)?o=s=64:isNaN(i)&&(s=64),l=l+h.charAt(a)+h.charAt(r)+h.charAt(o)+h.charAt(s);return l};if("undefined"!=typeof window&&"function"==typeof window.atob)var h=window.atob;if(void 0===h)h=function(e){var t,n,i,a,r,o,s="",l=0,A="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");l<e.length;)t=A.indexOf(e.charAt(l++))<<2|(a=A.indexOf(e.charAt(l++)))>>4,n=(15&a)<<4|(r=A.indexOf(e.charAt(l++)))>>2,i=(3&r)<<6|(o=A.indexOf(e.charAt(l++))),s+=String.fromCharCode(t),64!=r&&(s+=String.fromCharCode(n)),64!=o&&(s+=String.fromCharCode(i));return s};function u(e,t){if(!(t instanceof Array))throw new Error("'pack' error. Got invalid type argument.");if(e.length-1!=t.length)throw new Error("'pack' error. "+(e.length-1)+" marks, "+t.length+" elements.");var n;if("<"==e[0])n=!0;else{if(">"!=e[0])throw new Error("");n=!1}for(var i="",a=1,r=null,o=null,s=null;o=e[a];){if("b"==o.toLowerCase()){if(r=t[a-1],"b"==o&&r<0&&(r+=256),r>255||r<0)throw new Error("'pack' error.");s=String.fromCharCode(r)}else if("H"==o){if((r=t[a-1])>65535||r<0)throw new Error("'pack' error.");s=String.fromCharCode(Math.floor(r%65536/256))+String.fromCharCode(r%256),n&&(s=s.split("").reverse().join(""))}else{if("l"!=o.toLowerCase())throw new Error("'pack' error.");if(r=t[a-1],"l"==o&&r<0&&(r+=4294967296),r>4294967295||r<0)throw new Error("'pack' error.");s=String.fromCharCode(Math.floor(r/16777216))+String.fromCharCode(Math.floor(r%16777216/65536))+String.fromCharCode(Math.floor(r%65536/256))+String.fromCharCode(r%256),n&&(s=s.split("").reverse().join(""))}i+=s,a+=1}return i}function c(e,t){if("string"!=typeof t)throw new Error("'unpack' error. Got invalid type argument.");for(var n,i=0,a=1;a<e.length;a++)if("b"==e[a].toLowerCase())i+=1;else if("h"==e[a].toLowerCase())i+=2;else{if("l"!=e[a].toLowerCase())throw new Error("'unpack' error. Got invalid mark.");i+=4}if(i!=t.length)throw new Error("'unpack' error. Mismatch between symbol and string length. "+i+":"+t.length);if("<"==e[0])n=!0;else{if(">"!=e[0])throw new Error("'unpack' error.");n=!1}for(var r=[],o=0,s=1,l=null,A=null,h=null,u="";A=e[s];){if("b"==A.toLowerCase())h=1,l=(u=t.slice(o,o+h)).charCodeAt(0),"b"==A&&l>=128&&(l-=256);else if("H"==A)h=2,u=t.slice(o,o+h),n&&(u=u.split("").reverse().join("")),l=256*u.charCodeAt(0)+u.charCodeAt(1);else{if("l"!=A.toLowerCase())throw new Error("'unpack' error. "+A);h=4,u=t.slice(o,o+h),n&&(u=u.split("").reverse().join("")),l=16777216*u.charCodeAt(0)+65536*u.charCodeAt(1)+256*u.charCodeAt(2)+u.charCodeAt(3),"l"==A&&l>=2147483648&&(l-=4294967296)}r.push(l),o+=h,s+=1}return r}function f(e,t){for(var n="",i=0;i<t;i++)n+=e;return n}function g(e){if("ÿØ"!=e.slice(0,2))throw new Error("Given data isn't JPEG.");for(var t=2,n=["ÿØ"];1;){if("ÿÚ"==e.slice(t,t+2)){n.push(e.slice(t));break}var i=t+c(">H",e.slice(t+2,t+4))[0]+2;if(n.push(e.slice(t,i)),(t=i)>=e.length)throw new Error("Wrong JPEG data.")}return n}var m={Byte:1,Ascii:2,Short:3,Long:4,Rational:5,Undefined:7,SLong:9,SRational:10},p={Image:{11:{name:"ProcessingSoftware",type:"Ascii"},254:{name:"NewSubfileType",type:"Long"},255:{name:"SubfileType",type:"Short"},256:{name:"ImageWidth",type:"Long"},257:{name:"ImageLength",type:"Long"},258:{name:"BitsPerSample",type:"Short"},259:{name:"Compression",type:"Short"},262:{name:"PhotometricInterpretation",type:"Short"},263:{name:"Threshholding",type:"Short"},264:{name:"CellWidth",type:"Short"},265:{name:"CellLength",type:"Short"},266:{name:"FillOrder",type:"Short"},269:{name:"DocumentName",type:"Ascii"},270:{name:"ImageDescription",type:"Ascii"},271:{name:"Make",type:"Ascii"},272:{name:"Model",type:"Ascii"},273:{name:"StripOffsets",type:"Long"},274:{name:"Orientation",type:"Short"},277:{name:"SamplesPerPixel",type:"Short"},278:{name:"RowsPerStrip",type:"Long"},279:{name:"StripByteCounts",type:"Long"},282:{name:"XResolution",type:"Rational"},283:{name:"YResolution",type:"Rational"},284:{name:"PlanarConfiguration",type:"Short"},290:{name:"GrayResponseUnit",type:"Short"},291:{name:"GrayResponseCurve",type:"Short"},292:{name:"T4Options",type:"Long"},293:{name:"T6Options",type:"Long"},296:{name:"ResolutionUnit",type:"Short"},301:{name:"TransferFunction",type:"Short"},305:{name:"Software",type:"Ascii"},306:{name:"DateTime",type:"Ascii"},315:{name:"Artist",type:"Ascii"},316:{name:"HostComputer",type:"Ascii"},317:{name:"Predictor",type:"Short"},318:{name:"WhitePoint",type:"Rational"},319:{name:"PrimaryChromaticities",type:"Rational"},320:{name:"ColorMap",type:"Short"},321:{name:"HalftoneHints",type:"Short"},322:{name:"TileWidth",type:"Short"},323:{name:"TileLength",type:"Short"},324:{name:"TileOffsets",type:"Short"},325:{name:"TileByteCounts",type:"Short"},330:{name:"SubIFDs",type:"Long"},332:{name:"InkSet",type:"Short"},333:{name:"InkNames",type:"Ascii"},334:{name:"NumberOfInks",type:"Short"},336:{name:"DotRange",type:"Byte"},337:{name:"TargetPrinter",type:"Ascii"},338:{name:"ExtraSamples",type:"Short"},339:{name:"SampleFormat",type:"Short"},340:{name:"SMinSampleValue",type:"Short"},341:{name:"SMaxSampleValue",type:"Short"},342:{name:"TransferRange",type:"Short"},343:{name:"ClipPath",type:"Byte"},344:{name:"XClipPathUnits",type:"Long"},345:{name:"YClipPathUnits",type:"Long"},346:{name:"Indexed",type:"Short"},347:{name:"JPEGTables",type:"Undefined"},351:{name:"OPIProxy",type:"Short"},512:{name:"JPEGProc",type:"Long"},513:{name:"JPEGInterchangeFormat",type:"Long"},514:{name:"JPEGInterchangeFormatLength",type:"Long"},515:{name:"JPEGRestartInterval",type:"Short"},517:{name:"JPEGLosslessPredictors",type:"Short"},518:{name:"JPEGPointTransforms",type:"Short"},519:{name:"JPEGQTables",type:"Long"},520:{name:"JPEGDCTables",type:"Long"},521:{name:"JPEGACTables",type:"Long"},529:{name:"YCbCrCoefficients",type:"Rational"},530:{name:"YCbCrSubSampling",type:"Short"},531:{name:"YCbCrPositioning",type:"Short"},532:{name:"ReferenceBlackWhite",type:"Rational"},700:{name:"XMLPacket",type:"Byte"},18246:{name:"Rating",type:"Short"},18249:{name:"RatingPercent",type:"Short"},32781:{name:"ImageID",type:"Ascii"},33421:{name:"CFARepeatPatternDim",type:"Short"},33422:{name:"CFAPattern",type:"Byte"},33423:{name:"BatteryLevel",type:"Rational"},33432:{name:"Copyright",type:"Ascii"},33434:{name:"ExposureTime",type:"Rational"},34377:{name:"ImageResources",type:"Byte"},34665:{name:"ExifTag",type:"Long"},34675:{name:"InterColorProfile",type:"Undefined"},34853:{name:"GPSTag",type:"Long"},34857:{name:"Interlace",type:"Short"},34858:{name:"TimeZoneOffset",type:"Long"},34859:{name:"SelfTimerMode",type:"Short"},37387:{name:"FlashEnergy",type:"Rational"},37388:{name:"SpatialFrequencyResponse",type:"Undefined"},37389:{name:"Noise",type:"Undefined"},37390:{name:"FocalPlaneXResolution",type:"Rational"},37391:{name:"FocalPlaneYResolution",type:"Rational"},37392:{name:"FocalPlaneResolutionUnit",type:"Short"},37393:{name:"ImageNumber",type:"Long"},37394:{name:"SecurityClassification",type:"Ascii"},37395:{name:"ImageHistory",type:"Ascii"},37397:{name:"ExposureIndex",type:"Rational"},37398:{name:"TIFFEPStandardID",type:"Byte"},37399:{name:"SensingMethod",type:"Short"},40091:{name:"XPTitle",type:"Byte"},40092:{name:"XPComment",type:"Byte"},40093:{name:"XPAuthor",type:"Byte"},40094:{name:"XPKeywords",type:"Byte"},40095:{name:"XPSubject",type:"Byte"},50341:{name:"PrintImageMatching",type:"Undefined"},50706:{name:"DNGVersion",type:"Byte"},50707:{name:"DNGBackwardVersion",type:"Byte"},50708:{name:"UniqueCameraModel",type:"Ascii"},50709:{name:"LocalizedCameraModel",type:"Byte"},50710:{name:"CFAPlaneColor",type:"Byte"},50711:{name:"CFALayout",type:"Short"},50712:{name:"LinearizationTable",type:"Short"},50713:{name:"BlackLevelRepeatDim",type:"Short"},50714:{name:"BlackLevel",type:"Rational"},50715:{name:"BlackLevelDeltaH",type:"SRational"},50716:{name:"BlackLevelDeltaV",type:"SRational"},50717:{name:"WhiteLevel",type:"Short"},50718:{name:"DefaultScale",type:"Rational"},50719:{name:"DefaultCropOrigin",type:"Short"},50720:{name:"DefaultCropSize",type:"Short"},50721:{name:"ColorMatrix1",type:"SRational"},50722:{name:"ColorMatrix2",type:"SRational"},50723:{name:"CameraCalibration1",type:"SRational"},50724:{name:"CameraCalibration2",type:"SRational"},50725:{name:"ReductionMatrix1",type:"SRational"},50726:{name:"ReductionMatrix2",type:"SRational"},50727:{name:"AnalogBalance",type:"Rational"},50728:{name:"AsShotNeutral",type:"Short"},50729:{name:"AsShotWhiteXY",type:"Rational"},50730:{name:"BaselineExposure",type:"SRational"},50731:{name:"BaselineNoise",type:"Rational"},50732:{name:"BaselineSharpness",type:"Rational"},50733:{name:"BayerGreenSplit",type:"Long"},50734:{name:"LinearResponseLimit",type:"Rational"},50735:{name:"CameraSerialNumber",type:"Ascii"},50736:{name:"LensInfo",type:"Rational"},50737:{name:"ChromaBlurRadius",type:"Rational"},50738:{name:"AntiAliasStrength",type:"Rational"},50739:{name:"ShadowScale",type:"SRational"},50740:{name:"DNGPrivateData",type:"Byte"},50741:{name:"MakerNoteSafety",type:"Short"},50778:{name:"CalibrationIlluminant1",type:"Short"},50779:{name:"CalibrationIlluminant2",type:"Short"},50780:{name:"BestQualityScale",type:"Rational"},50781:{name:"RawDataUniqueID",type:"Byte"},50827:{name:"OriginalRawFileName",type:"Byte"},50828:{name:"OriginalRawFileData",type:"Undefined"},50829:{name:"ActiveArea",type:"Short"},50830:{name:"MaskedAreas",type:"Short"},50831:{name:"AsShotICCProfile",type:"Undefined"},50832:{name:"AsShotPreProfileMatrix",type:"SRational"},50833:{name:"CurrentICCProfile",type:"Undefined"},50834:{name:"CurrentPreProfileMatrix",type:"SRational"},50879:{name:"ColorimetricReference",type:"Short"},50931:{name:"CameraCalibrationSignature",type:"Byte"},50932:{name:"ProfileCalibrationSignature",type:"Byte"},50934:{name:"AsShotProfileName",type:"Byte"},50935:{name:"NoiseReductionApplied",type:"Rational"},50936:{name:"ProfileName",type:"Byte"},50937:{name:"ProfileHueSatMapDims",type:"Long"},50938:{name:"ProfileHueSatMapData1",type:"Float"},50939:{name:"ProfileHueSatMapData2",type:"Float"},50940:{name:"ProfileToneCurve",type:"Float"},50941:{name:"ProfileEmbedPolicy",type:"Long"},50942:{name:"ProfileCopyright",type:"Byte"},50964:{name:"ForwardMatrix1",type:"SRational"},50965:{name:"ForwardMatrix2",type:"SRational"},50966:{name:"PreviewApplicationName",type:"Byte"},50967:{name:"PreviewApplicationVersion",type:"Byte"},50968:{name:"PreviewSettingsName",type:"Byte"},50969:{name:"PreviewSettingsDigest",type:"Byte"},50970:{name:"PreviewColorSpace",type:"Long"},50971:{name:"PreviewDateTime",type:"Ascii"},50972:{name:"RawImageDigest",type:"Undefined"},50973:{name:"OriginalRawFileDigest",type:"Undefined"},50974:{name:"SubTileBlockSize",type:"Long"},50975:{name:"RowInterleaveFactor",type:"Long"},50981:{name:"ProfileLookTableDims",type:"Long"},50982:{name:"ProfileLookTableData",type:"Float"},51008:{name:"OpcodeList1",type:"Undefined"},51009:{name:"OpcodeList2",type:"Undefined"},51022:{name:"OpcodeList3",type:"Undefined"}},Exif:{33434:{name:"ExposureTime",type:"Rational"},33437:{name:"FNumber",type:"Rational"},34850:{name:"ExposureProgram",type:"Short"},34852:{name:"SpectralSensitivity",type:"Ascii"},34855:{name:"ISOSpeedRatings",type:"Short"},34856:{name:"OECF",type:"Undefined"},34864:{name:"SensitivityType",type:"Short"},34865:{name:"StandardOutputSensitivity",type:"Long"},34866:{name:"RecommendedExposureIndex",type:"Long"},34867:{name:"ISOSpeed",type:"Long"},34868:{name:"ISOSpeedLatitudeyyy",type:"Long"},34869:{name:"ISOSpeedLatitudezzz",type:"Long"},36864:{name:"ExifVersion",type:"Undefined"},36867:{name:"DateTimeOriginal",type:"Ascii"},36868:{name:"DateTimeDigitized",type:"Ascii"},37121:{name:"ComponentsConfiguration",type:"Undefined"},37122:{name:"CompressedBitsPerPixel",type:"Rational"},37377:{name:"ShutterSpeedValue",type:"SRational"},37378:{name:"ApertureValue",type:"Rational"},37379:{name:"BrightnessValue",type:"SRational"},37380:{name:"ExposureBiasValue",type:"SRational"},37381:{name:"MaxApertureValue",type:"Rational"},37382:{name:"SubjectDistance",type:"Rational"},37383:{name:"MeteringMode",type:"Short"},37384:{name:"LightSource",type:"Short"},37385:{name:"Flash",type:"Short"},37386:{name:"FocalLength",type:"Rational"},37396:{name:"SubjectArea",type:"Short"},37500:{name:"MakerNote",type:"Undefined"},37510:{name:"UserComment",type:"Ascii"},37520:{name:"SubSecTime",type:"Ascii"},37521:{name:"SubSecTimeOriginal",type:"Ascii"},37522:{name:"SubSecTimeDigitized",type:"Ascii"},40960:{name:"FlashpixVersion",type:"Undefined"},40961:{name:"ColorSpace",type:"Short"},40962:{name:"PixelXDimension",type:"Long"},40963:{name:"PixelYDimension",type:"Long"},40964:{name:"RelatedSoundFile",type:"Ascii"},40965:{name:"InteroperabilityTag",type:"Long"},41483:{name:"FlashEnergy",type:"Rational"},41484:{name:"SpatialFrequencyResponse",type:"Undefined"},41486:{name:"FocalPlaneXResolution",type:"Rational"},41487:{name:"FocalPlaneYResolution",type:"Rational"},41488:{name:"FocalPlaneResolutionUnit",type:"Short"},41492:{name:"SubjectLocation",type:"Short"},41493:{name:"ExposureIndex",type:"Rational"},41495:{name:"SensingMethod",type:"Short"},41728:{name:"FileSource",type:"Undefined"},41729:{name:"SceneType",type:"Undefined"},41730:{name:"CFAPattern",type:"Undefined"},41985:{name:"CustomRendered",type:"Short"},41986:{name:"ExposureMode",type:"Short"},41987:{name:"WhiteBalance",type:"Short"},41988:{name:"DigitalZoomRatio",type:"Rational"},41989:{name:"FocalLengthIn35mmFilm",type:"Short"},41990:{name:"SceneCaptureType",type:"Short"},41991:{name:"GainControl",type:"Short"},41992:{name:"Contrast",type:"Short"},41993:{name:"Saturation",type:"Short"},41994:{name:"Sharpness",type:"Short"},41995:{name:"DeviceSettingDescription",type:"Undefined"},41996:{name:"SubjectDistanceRange",type:"Short"},42016:{name:"ImageUniqueID",type:"Ascii"},42032:{name:"CameraOwnerName",type:"Ascii"},42033:{name:"BodySerialNumber",type:"Ascii"},42034:{name:"LensSpecification",type:"Rational"},42035:{name:"LensMake",type:"Ascii"},42036:{name:"LensModel",type:"Ascii"},42037:{name:"LensSerialNumber",type:"Ascii"},42240:{name:"Gamma",type:"Rational"}},GPS:{0:{name:"GPSVersionID",type:"Byte"},1:{name:"GPSLatitudeRef",type:"Ascii"},2:{name:"GPSLatitude",type:"Rational"},3:{name:"GPSLongitudeRef",type:"Ascii"},4:{name:"GPSLongitude",type:"Rational"},5:{name:"GPSAltitudeRef",type:"Byte"},6:{name:"GPSAltitude",type:"Rational"},7:{name:"GPSTimeStamp",type:"Rational"},8:{name:"GPSSatellites",type:"Ascii"},9:{name:"GPSStatus",type:"Ascii"},10:{name:"GPSMeasureMode",type:"Ascii"},11:{name:"GPSDOP",type:"Rational"},12:{name:"GPSSpeedRef",type:"Ascii"},13:{name:"GPSSpeed",type:"Rational"},14:{name:"GPSTrackRef",type:"Ascii"},15:{name:"GPSTrack",type:"Rational"},16:{name:"GPSImgDirectionRef",type:"Ascii"},17:{name:"GPSImgDirection",type:"Rational"},18:{name:"GPSMapDatum",type:"Ascii"},19:{name:"GPSDestLatitudeRef",type:"Ascii"},20:{name:"GPSDestLatitude",type:"Rational"},21:{name:"GPSDestLongitudeRef",type:"Ascii"},22:{name:"GPSDestLongitude",type:"Rational"},23:{name:"GPSDestBearingRef",type:"Ascii"},24:{name:"GPSDestBearing",type:"Rational"},25:{name:"GPSDestDistanceRef",type:"Ascii"},26:{name:"GPSDestDistance",type:"Rational"},27:{name:"GPSProcessingMethod",type:"Undefined"},28:{name:"GPSAreaInformation",type:"Undefined"},29:{name:"GPSDateStamp",type:"Ascii"},30:{name:"GPSDifferential",type:"Short"},31:{name:"GPSHPositioningError",type:"Rational"}},Interop:{1:{name:"InteroperabilityIndex",type:"Ascii"}}};p["0th"]=p["Image"],p["1st"]=p["Image"],n.TAGS=p,n.ImageIFD={ProcessingSoftware:11,NewSubfileType:254,SubfileType:255,ImageWidth:256,ImageLength:257,BitsPerSample:258,Compression:259,PhotometricInterpretation:262,Threshholding:263,CellWidth:264,CellLength:265,FillOrder:266,DocumentName:269,ImageDescription:270,Make:271,Model:272,StripOffsets:273,Orientation:274,SamplesPerPixel:277,RowsPerStrip:278,StripByteCounts:279,XResolution:282,YResolution:283,PlanarConfiguration:284,GrayResponseUnit:290,GrayResponseCurve:291,T4Options:292,T6Options:293,ResolutionUnit:296,TransferFunction:301,Software:305,DateTime:306,Artist:315,HostComputer:316,Predictor:317,WhitePoint:318,PrimaryChromaticities:319,ColorMap:320,HalftoneHints:321,TileWidth:322,TileLength:323,TileOffsets:324,TileByteCounts:325,SubIFDs:330,InkSet:332,InkNames:333,NumberOfInks:334,DotRange:336,TargetPrinter:337,ExtraSamples:338,SampleFormat:339,SMinSampleValue:340,SMaxSampleValue:341,TransferRange:342,ClipPath:343,XClipPathUnits:344,YClipPathUnits:345,Indexed:346,JPEGTables:347,OPIProxy:351,JPEGProc:512,JPEGInterchangeFormat:513,JPEGInterchangeFormatLength:514,JPEGRestartInterval:515,JPEGLosslessPredictors:517,JPEGPointTransforms:518,JPEGQTables:519,JPEGDCTables:520,JPEGACTables:521,YCbCrCoefficients:529,YCbCrSubSampling:530,YCbCrPositioning:531,ReferenceBlackWhite:532,XMLPacket:700,Rating:18246,RatingPercent:18249,ImageID:32781,CFARepeatPatternDim:33421,CFAPattern:33422,BatteryLevel:33423,Copyright:33432,ExposureTime:33434,ImageResources:34377,ExifTag:34665,InterColorProfile:34675,GPSTag:34853,Interlace:34857,TimeZoneOffset:34858,SelfTimerMode:34859,FlashEnergy:37387,SpatialFrequencyResponse:37388,Noise:37389,FocalPlaneXResolution:37390,FocalPlaneYResolution:37391,FocalPlaneResolutionUnit:37392,ImageNumber:37393,SecurityClassification:37394,ImageHistory:37395,ExposureIndex:37397,TIFFEPStandardID:37398,SensingMethod:37399,XPTitle:40091,XPComment:40092,XPAuthor:40093,XPKeywords:40094,XPSubject:40095,PrintImageMatching:50341,DNGVersion:50706,DNGBackwardVersion:50707,UniqueCameraModel:50708,LocalizedCameraModel:50709,CFAPlaneColor:50710,CFALayout:50711,LinearizationTable:50712,BlackLevelRepeatDim:50713,BlackLevel:50714,BlackLevelDeltaH:50715,BlackLevelDeltaV:50716,WhiteLevel:50717,DefaultScale:50718,DefaultCropOrigin:50719,DefaultCropSize:50720,ColorMatrix1:50721,ColorMatrix2:50722,CameraCalibration1:50723,CameraCalibration2:50724,ReductionMatrix1:50725,ReductionMatrix2:50726,AnalogBalance:50727,AsShotNeutral:50728,AsShotWhiteXY:50729,BaselineExposure:50730,BaselineNoise:50731,BaselineSharpness:50732,BayerGreenSplit:50733,LinearResponseLimit:50734,CameraSerialNumber:50735,LensInfo:50736,ChromaBlurRadius:50737,AntiAliasStrength:50738,ShadowScale:50739,DNGPrivateData:50740,MakerNoteSafety:50741,CalibrationIlluminant1:50778,CalibrationIlluminant2:50779,BestQualityScale:50780,RawDataUniqueID:50781,OriginalRawFileName:50827,OriginalRawFileData:50828,ActiveArea:50829,MaskedAreas:50830,AsShotICCProfile:50831,AsShotPreProfileMatrix:50832,CurrentICCProfile:50833,CurrentPreProfileMatrix:50834,ColorimetricReference:50879,CameraCalibrationSignature:50931,ProfileCalibrationSignature:50932,AsShotProfileName:50934,NoiseReductionApplied:50935,ProfileName:50936,ProfileHueSatMapDims:50937,ProfileHueSatMapData1:50938,ProfileHueSatMapData2:50939,ProfileToneCurve:50940,ProfileEmbedPolicy:50941,ProfileCopyright:50942,ForwardMatrix1:50964,ForwardMatrix2:50965,PreviewApplicationName:50966,PreviewApplicationVersion:50967,PreviewSettingsName:50968,PreviewSettingsDigest:50969,PreviewColorSpace:50970,PreviewDateTime:50971,RawImageDigest:50972,OriginalRawFileDigest:50973,SubTileBlockSize:50974,RowInterleaveFactor:50975,ProfileLookTableDims:50981,ProfileLookTableData:50982,OpcodeList1:51008,OpcodeList2:51009,OpcodeList3:51022,NoiseProfile:51041},n.ExifIFD={ExposureTime:33434,FNumber:33437,ExposureProgram:34850,SpectralSensitivity:34852,ISOSpeedRatings:34855,OECF:34856,SensitivityType:34864,StandardOutputSensitivity:34865,RecommendedExposureIndex:34866,ISOSpeed:34867,ISOSpeedLatitudeyyy:34868,ISOSpeedLatitudezzz:34869,ExifVersion:36864,DateTimeOriginal:36867,DateTimeDigitized:36868,ComponentsConfiguration:37121,CompressedBitsPerPixel:37122,ShutterSpeedValue:37377,ApertureValue:37378,BrightnessValue:37379,ExposureBiasValue:37380,MaxApertureValue:37381,SubjectDistance:37382,MeteringMode:37383,LightSource:37384,Flash:37385,FocalLength:37386,SubjectArea:37396,MakerNote:37500,UserComment:37510,SubSecTime:37520,SubSecTimeOriginal:37521,SubSecTimeDigitized:37522,FlashpixVersion:40960,ColorSpace:40961,PixelXDimension:40962,PixelYDimension:40963,RelatedSoundFile:40964,InteroperabilityTag:40965,FlashEnergy:41483,SpatialFrequencyResponse:41484,FocalPlaneXResolution:41486,FocalPlaneYResolution:41487,FocalPlaneResolutionUnit:41488,SubjectLocation:41492,ExposureIndex:41493,SensingMethod:41495,FileSource:41728,SceneType:41729,CFAPattern:41730,CustomRendered:41985,ExposureMode:41986,WhiteBalance:41987,DigitalZoomRatio:41988,FocalLengthIn35mmFilm:41989,SceneCaptureType:41990,GainControl:41991,Contrast:41992,Saturation:41993,Sharpness:41994,DeviceSettingDescription:41995,SubjectDistanceRange:41996,ImageUniqueID:42016,CameraOwnerName:42032,BodySerialNumber:42033,LensSpecification:42034,LensMake:42035,LensModel:42036,LensSerialNumber:42037,Gamma:42240},n.GPSIFD={GPSVersionID:0,GPSLatitudeRef:1,GPSLatitude:2,GPSLongitudeRef:3,GPSLongitude:4,GPSAltitudeRef:5,GPSAltitude:6,GPSTimeStamp:7,GPSSatellites:8,GPSStatus:9,GPSMeasureMode:10,GPSDOP:11,GPSSpeedRef:12,GPSSpeed:13,GPSTrackRef:14,GPSTrack:15,GPSImgDirectionRef:16,GPSImgDirection:17,GPSMapDatum:18,GPSDestLatitudeRef:19,GPSDestLatitude:20,GPSDestLongitudeRef:21,GPSDestLongitude:22,GPSDestBearingRef:23,GPSDestBearing:24,GPSDestDistanceRef:25,GPSDestDistance:26,GPSProcessingMethod:27,GPSAreaInformation:28,GPSDateStamp:29,GPSDifferential:30,GPSHPositioningError:31},n.InteropIFD={InteroperabilityIndex:1},n.GPSHelper={degToDmsRational:function(e){var t=Math.abs(e),n=t%1*60,i=n%1*60;return[[Math.floor(t),1],[Math.floor(n),1],[Math.round(100*i),100]]},dmsRationalToDeg:function(e,t){var n="S"===t||"W"===t?-1:1;return(e[0][0]/e[0][1]+e[1][0]/e[1][1]/60+e[2][0]/e[2][1]/3600)*n}},e.exports&&(t=e.exports=n),t.piexif=n}()}));l.piexif;function A(e){var t={};try{var n=l.load(e);for(var i in n)if("thumbnail"!==i)for(var a in t[i]={},n[i])t[i][l.TAGS[i][a]["name"]]=n[i][a]}catch(e){console.warn("Error on read exif data")}return t}function h(e,t){var n=document.createElement("canvas");n.width=e.width,n.height=e.height;var i=n.getContext("2d"),a=0,r=0;return i.save(),2===t?(a=-n.width,i.scale(-1,1)):3===t||3===t?(a=-n.width,r=-n.height,i.scale(-1,-1)):4===t?(r=-n.height,i.scale(1,-1)):5===t?(n.width=e.height,n.height=e.width,i.translate(n.width,n.height/n.width),i.rotate(Math.PI/2),r=-n.width,i.scale(1,-1)):6===t?(n.width=e.height,n.height=e.width,i.translate(n.width,n.height/n.width),i.rotate(Math.PI/2)):7===t?(n.width=e.height,n.height=e.width,i.translate(n.width,n.height/n.width),i.rotate(Math.PI/2),a=-n.height,i.scale(-1,1)):8===t&&(n.width=e.height,n.height=e.width,i.translate(n.width,n.height/n.width),i.rotate(Math.PI/2),a=-n.height,r=-n.width,i.scale(-1,-1)),i.drawImage(e,a,r),i.restore(),n}function u(e,t){return function(){return Promise.resolve({canvas:e,fileName:t})}}var c=t((function(t,n){
/*!

	pica
	https://github.com/nodeca/pica

	*/
t.exports=function t(n,i,a){function r(s,l){if(!i[s]){if(!n[s]){var A="function"==typeof e&&e;if(!l&&A)return A(s,!0);if(o)return o(s,!0);var h=new Error("Cannot find module '"+s+"'");throw h.code="MODULE_NOT_FOUND",h}var u=i[s]={exports:{}};n[s][0].call(u.exports,(function(e){return r(n[s][1][e]||e)}),u,u.exports,t,n,i,a)}return i[s].exports}for(var o="function"==typeof e&&e,s=0;s<a.length;s++)r(a[s]);return r}({1:[function(e,t,n){var i=e("multimath"),a=e("./mm_unsharp_mask"),r=e("./mm_resize");function o(e){var t=e||[],n={js:t.indexOf("js")>=0,wasm:t.indexOf("wasm")>=0};i.call(this,n),this.features={js:n.js,wasm:n.wasm&&this.has_wasm()},this.use(a),this.use(r)}o.prototype=Object.create(i.prototype),o.prototype.constructor=o,o.prototype.resizeAndUnsharp=function(e,t){var n=this.resize(e,t);return e.unsharpAmount&&this.unsharp_mask(n,e.toWidth,e.toHeight,e.unsharpAmount,e.unsharpRadius,e.unsharpThreshold),n},t.exports=o},{"./mm_resize":4,"./mm_unsharp_mask":9,multimath:19}],2:[function(e,t,n){function i(e){return e<0?0:e>255?255:e}function a(e){return e>=0?e:0}t.exports={convolveHor:function(e,t,n,i,r,o){var s,l,A,h,u,c,f,g,m,p,d,y=0,v=0;for(m=0;m<i;m++){for(u=0,p=0;p<r;p++){for(c=o[u++],f=o[u++],g=y+4*c|0,s=l=A=h=0;f>0;f--)h=h+(d=o[u++])*e[g+3]|0,A=A+d*e[g+2]|0,l=l+d*e[g+1]|0,s=s+d*e[g]|0,g=g+4|0;t[v+3]=a(h>>7),t[v+2]=a(A>>7),t[v+1]=a(l>>7),t[v]=a(s>>7),v=v+4*i|0}v=4*(m+1)|0,y=(m+1)*n*4|0}},convolveVert:function(e,t,n,a,r,o){var s,l,A,h,u,c,f,g,m,p,d,y=0,v=0;for(m=0;m<a;m++){for(u=0,p=0;p<r;p++){for(c=o[u++],f=o[u++],g=y+4*c|0,s=l=A=h=0;f>0;f--)h=h+(d=o[u++])*e[g+3]|0,A=A+d*e[g+2]|0,l=l+d*e[g+1]|0,s=s+d*e[g]|0,g=g+4|0;s>>=7,l>>=7,A>>=7,h>>=7,t[v+3]=i(h+(1<<13)>>14),t[v+2]=i(A+(1<<13)>>14),t[v+1]=i(l+(1<<13)>>14),t[v]=i(s+(1<<13)>>14),v=v+4*a|0}v=4*(m+1)|0,y=(m+1)*n*4|0}},convolveHorWithPre:function(e,t,n,i,r,o){var s,l,A,h,u,c,f,g,m,p,d,y,v=0,I=0;for(p=0;p<i;p++){for(c=0,d=0;d<r;d++){for(f=o[c++],g=o[c++],m=v+4*f|0,s=l=A=h=0;g>0;g--)h=h+(y=o[c++])*(u=e[m+3])|0,A=A+y*e[m+2]*u|0,l=l+y*e[m+1]*u|0,s=s+y*e[m]*u|0,m=m+4|0;A=A/255|0,l=l/255|0,s=s/255|0,t[I+3]=a(h>>7),t[I+2]=a(A>>7),t[I+1]=a(l>>7),t[I]=a(s>>7),I=I+4*i|0}I=4*(p+1)|0,v=(p+1)*n*4|0}},convolveVertWithPre:function(e,t,n,a,r,o){var s,l,A,h,u,c,f,g,m,p,d,y=0,v=0;for(m=0;m<a;m++){for(u=0,p=0;p<r;p++){for(c=o[u++],f=o[u++],g=y+4*c|0,s=l=A=h=0;f>0;f--)h=h+(d=o[u++])*e[g+3]|0,A=A+d*e[g+2]|0,l=l+d*e[g+1]|0,s=s+d*e[g]|0,g=g+4|0;s>>=7,l>>=7,A>>=7,(h=i((h>>=7)+(1<<13)>>14))>0&&(s=255*s/h|0,l=255*l/h|0,A=255*A/h|0),t[v+3]=h,t[v+2]=i(A+(1<<13)>>14),t[v+1]=i(l+(1<<13)>>14),t[v]=i(s+(1<<13)>>14),v=v+4*a|0}v=4*(m+1)|0,y=(m+1)*n*4|0}}}},{}],3:[function(e,t,n){t.exports="AGFzbQEAAAAADAZkeWxpbmsAAAAAAAEYA2AGf39/f39/AGAAAGAIf39/f39/f38AAg8BA2VudgZtZW1vcnkCAAADBwYBAAAAAAIGBgF/AEEACweUAQgRX193YXNtX2NhbGxfY3RvcnMAAAtjb252b2x2ZUhvcgABDGNvbnZvbHZlVmVydAACEmNvbnZvbHZlSG9yV2l0aFByZQADE2NvbnZvbHZlVmVydFdpdGhQcmUABApjb252b2x2ZUhWAAUMX19kc29faGFuZGxlAwAYX193YXNtX2FwcGx5X2RhdGFfcmVsb2NzAAAKyA4GAwABC4wDARB/AkAgA0UNACAERQ0AIANBAnQhFQNAQQAhE0EAIQsDQCALQQJqIQcCfyALQQF0IAVqIgYuAQIiC0UEQEEAIQhBACEGQQAhCUEAIQogBwwBCyASIAYuAQBqIQhBACEJQQAhCiALIRRBACEOIAchBkEAIQ8DQCAFIAZBAXRqLgEAIhAgACAIQQJ0aigCACIRQRh2bCAPaiEPIBFB/wFxIBBsIAlqIQkgEUEQdkH/AXEgEGwgDmohDiARQQh2Qf8BcSAQbCAKaiEKIAhBAWohCCAGQQFqIQYgFEEBayIUDQALIAlBB3UhCCAKQQd1IQYgDkEHdSEJIA9BB3UhCiAHIAtqCyELIAEgDEEBdCIHaiAIQQAgCEEAShs7AQAgASAHQQJyaiAGQQAgBkEAShs7AQAgASAHQQRyaiAJQQAgCUEAShs7AQAgASAHQQZyaiAKQQAgCkEAShs7AQAgDCAVaiEMIBNBAWoiEyAERw0ACyANQQFqIg0gAmwhEiANQQJ0IQwgAyANRw0ACwsL2gMBD38CQCADRQ0AIARFDQAgAkECdCEUA0AgCyEMQQAhE0EAIQIDQCACQQJqIQYCfyACQQF0IAVqIgcuAQIiAkUEQEEAIQhBACEHQQAhCkEAIQkgBgwBCyAHLgEAQQJ0IBJqIQhBACEJIAIhCkEAIQ0gBiEHQQAhDkEAIQ8DQCAFIAdBAXRqLgEAIhAgACAIQQF0IhFqLwEAbCAJaiEJIAAgEUEGcmovAQAgEGwgDmohDiAAIBFBBHJqLwEAIBBsIA9qIQ8gACARQQJyai8BACAQbCANaiENIAhBBGohCCAHQQFqIQcgCkEBayIKDQALIAlBB3UhCCANQQd1IQcgDkEHdSEKIA9BB3UhCSACIAZqCyECIAEgDEECdGogB0GAQGtBDnUiBkH/ASAGQf8BSBsiBkEAIAZBAEobQQh0QYD+A3EgCUGAQGtBDnUiBkH/ASAGQf8BSBsiBkEAIAZBAEobQRB0QYCA/AdxIApBgEBrQQ51IgZB/wEgBkH/AUgbIgZBACAGQQBKG0EYdHJyIAhBgEBrQQ51IgZB/wEgBkH/AUgbIgZBACAGQQBKG3I2AgAgAyAMaiEMIBNBAWoiEyAERw0ACyAUIAtBAWoiC2whEiADIAtHDQALCwuSAwEQfwJAIANFDQAgBEUNACADQQJ0IRUDQEEAIRNBACEGA0AgBkECaiEIAn8gBkEBdCAFaiIGLgECIgdFBEBBACEJQQAhDEEAIQ1BACEOIAgMAQsgEiAGLgEAaiEJQQAhDkEAIQ1BACEMIAchFEEAIQ8gCCEGA0AgBSAGQQF0ai4BACAAIAlBAnRqKAIAIhBBGHZsIhEgD2ohDyARIBBBEHZB/wFxbCAMaiEMIBEgEEEIdkH/AXFsIA1qIQ0gESAQQf8BcWwgDmohDiAJQQFqIQkgBkEBaiEGIBRBAWsiFA0ACyAPQQd1IQkgByAIagshBiABIApBAXQiCGogDkH/AW1BB3UiB0EAIAdBAEobOwEAIAEgCEECcmogDUH/AW1BB3UiB0EAIAdBAEobOwEAIAEgCEEEcmogDEH/AW1BB3UiB0EAIAdBAEobOwEAIAEgCEEGcmogCUEAIAlBAEobOwEAIAogFWohCiATQQFqIhMgBEcNAAsgC0EBaiILIAJsIRIgC0ECdCEKIAMgC0cNAAsLC4IEAQ9/AkAgA0UNACAERQ0AIAJBAnQhFANAIAshDEEAIRJBACEHA0AgB0ECaiEKAn8gB0EBdCAFaiICLgECIhNFBEBBACEIQQAhCUEAIQYgCiEHQQAMAQsgAi4BAEECdCARaiEJQQAhByATIQJBACENIAohBkEAIQ5BACEPA0AgBSAGQQF0ai4BACIIIAAgCUEBdCIQai8BAGwgB2ohByAAIBBBBnJqLwEAIAhsIA5qIQ4gACAQQQRyai8BACAIbCAPaiEPIAAgEEECcmovAQAgCGwgDWohDSAJQQRqIQkgBkEBaiEGIAJBAWsiAg0ACyAHQQd1IQggDUEHdSEJIA9BB3UhBiAKIBNqIQcgDkEHdQtBgEBrQQ51IgJB/wEgAkH/AUgbIgJBACACQQBKGyIKQf8BcQRAIAlB/wFsIAJtIQkgCEH/AWwgAm0hCCAGQf8BbCACbSEGCyABIAxBAnRqIAlBgEBrQQ51IgJB/wEgAkH/AUgbIgJBACACQQBKG0EIdEGA/gNxIAZBgEBrQQ51IgJB/wEgAkH/AUgbIgJBACACQQBKG0EQdEGAgPwHcSAKQRh0ciAIQYBAa0EOdSICQf8BIAJB/wFIGyICQQAgAkEAShtycjYCACADIAxqIQwgEkEBaiISIARHDQALIBQgC0EBaiILbCERIAMgC0cNAAsLC0AAIAcEQEEAIAIgAyAEIAUgABADIAJBACAEIAUgBiABEAQPC0EAIAIgAyAEIAUgABABIAJBACAEIAUgBiABEAIL"},{}],4:[function(e,t,n){t.exports={name:"resize",fn:e("./resize"),wasm_fn:e("./resize_wasm"),wasm_src:e("./convolve_wasm_base64")}},{"./convolve_wasm_base64":3,"./resize":5,"./resize_wasm":8}],5:[function(e,t,n){var i=e("./resize_filter_gen"),a=e("./convolve"),r=a.convolveHor,o=a.convolveVert,s=a.convolveHorWithPre,l=a.convolveVertWithPre;t.exports=function(e){var t=e.src,n=e.width,a=e.height,A=e.toWidth,h=e.toHeight,u=e.scaleX||e.toWidth/e.width,c=e.scaleY||e.toHeight/e.height,f=e.offsetX||0,g=e.offsetY||0,m=e.dest||new Uint8Array(A*h*4),p=void 0===e.filter?"mks2013":e.filter,d=i(p,n,A,u,f),y=i(p,a,h,c,g),v=new Uint16Array(A*a*4);return function(e,t,n){for(var i=3,a=t*n*4|0;i<a;){if(255!==e[i])return!0;i=i+4|0}return!1}(t,n,a)?(s(t,v,n,a,A,d),l(v,m,a,A,h,y)):(r(t,v,n,a,A,d),o(v,m,a,A,h,y),function(e,t,n){for(var i=3,a=t*n*4|0;i<a;)e[i]=255,i=i+4|0}(m,A,h)),m}},{"./convolve":2,"./resize_filter_gen":6}],6:[function(e,t,n){var i=e("./resize_filter_info"),a=14;function r(e){return Math.round(e*((1<<a)-1))}t.exports=function(e,t,n,a,o){var s,l,A,h,u,c,f,g,m,p,d,y,v,I,w,C,B,E=i.filter[e].fn,S=1/a,b=Math.min(1,a),_=i.filter[e].win/b,Q=Math.floor(2*(_+1)),P=new Int16Array((Q+2)*n),x=0,R=!P.subarray||!P.set;for(s=0;s<n;s++){for(l=(s+.5)*S+o,A=Math.max(0,Math.floor(l-_)),u=(h=Math.min(t-1,Math.ceil(l+_)))-A+1,c=new Float32Array(u),f=new Int16Array(u),g=0,m=A,p=0;m<=h;m++,p++)g+=d=E((m+.5-l)*b),c[p]=d;for(y=0,p=0;p<c.length;p++)y+=v=c[p]/g,f[p]=r(v);for(f[n>>1]+=r(1-y),I=0;I<f.length&&0===f[I];)I++;if(I<f.length){for(w=f.length-1;w>0&&0===f[w];)w--;if(C=A+I,B=w-I+1,P[x++]=C,P[x++]=B,R)for(p=I;p<=w;p++)P[x++]=f[p];else P.set(f.subarray(I,w+1),x),x+=B}else P[x++]=0,P[x++]=0}return P}},{"./resize_filter_info":7}],7:[function(e,t,n){var i={box:{win:.5,fn:function(e){return e<0&&(e=-e),e<.5?1:0}},hamming:{win:1,fn:function(e){if(e<0&&(e=-e),e>=1)return 0;if(e<1.1920929e-7)return 1;var t=e*Math.PI;return Math.sin(t)/t*(.54+.46*Math.cos(t/1))}},lanczos2:{win:2,fn:function(e){if(e<0&&(e=-e),e>=2)return 0;if(e<1.1920929e-7)return 1;var t=e*Math.PI;return Math.sin(t)/t*Math.sin(t/2)/(t/2)}},lanczos3:{win:3,fn:function(e){if(e<0&&(e=-e),e>=3)return 0;if(e<1.1920929e-7)return 1;var t=e*Math.PI;return Math.sin(t)/t*Math.sin(t/3)/(t/3)}},mks2013:{win:2.5,fn:function(e){return e<0&&(e=-e),e>=2.5?0:e>=1.5?-.125*(e-2.5)*(e-2.5):e>=.5?.25*(4*e*e-11*e+7):1.0625-1.75*e*e}}};t.exports={filter:i,f2q:{box:0,hamming:1,lanczos2:2,lanczos3:3},q2f:["box","hamming","lanczos2","lanczos3"]}},{}],8:[function(e,t,n){var i=e("./resize_filter_gen"),a=!0;try{a=1===new Uint32Array(new Uint8Array([1,0,0,0]).buffer)[0]}catch(e){}function r(e,t,n){if(a)t.set(function(e){return new Uint8Array(e.buffer,0,e.byteLength)}(e),n);else for(var i=n,r=0;r<e.length;r++){var o=e[r];t[i++]=255&o,t[i++]=o>>8&255}}t.exports=function(e){var t=e.src,n=e.width,a=e.height,o=e.toWidth,s=e.toHeight,l=e.scaleX||e.toWidth/e.width,A=e.scaleY||e.toHeight/e.height,h=e.offsetX||0,u=e.offsetY||0,c=e.dest||new Uint8Array(o*s*4),f=void 0===e.filter?"mks2013":e.filter,g=i(f,n,o,l,h),m=i(f,a,s,A,u),p=Math.max(t.byteLength,c.byteLength),d=this.__align(0+p),y=a*o*4*2,v=this.__align(d+y),I=this.__align(v+g.byteLength),w=I+m.byteLength,C=this.__instance("resize",w),B=new Uint8Array(this.__memory.buffer),E=new Uint32Array(this.__memory.buffer),S=new Uint32Array(t.buffer);E.set(S),r(g,B,v),r(m,B,I);var b=C.exports.convolveHV||C.exports._convolveHV;return function(e,t,n){for(var i=3,a=t*n*4|0;i<a;){if(255!==e[i])return!0;i=i+4|0}return!1}(t,n,a)?b(v,I,d,n,a,o,s,1):(b(v,I,d,n,a,o,s,0),function(e,t,n){for(var i=3,a=t*n*4|0;i<a;)e[i]=255,i=i+4|0}(c,o,s)),new Uint32Array(c.buffer).set(new Uint32Array(this.__memory.buffer,0,s*o)),c}},{"./resize_filter_gen":6}],9:[function(e,t,n){t.exports={name:"unsharp_mask",fn:e("./unsharp_mask"),wasm_fn:e("./unsharp_mask_wasm"),wasm_src:e("./unsharp_mask_wasm_base64")}},{"./unsharp_mask":10,"./unsharp_mask_wasm":11,"./unsharp_mask_wasm_base64":12}],10:[function(e,t,n){var i=e("glur/mono16");t.exports=function(e,t,n,a,r,o){var s,l,A,h,u;if(!(0===a||r<.5)){r>2&&(r=2);var c=function(e,t,n){for(var i,a,r,o,s=t*n,l=new Uint16Array(s),A=0;A<s;A++)i=e[4*A],a=e[4*A+1],r=e[4*A+2],o=i>=a&&i>=r?i:a>=r&&a>=i?a:r,l[A]=o<<8;return l}(e,t,n),f=new Uint16Array(c);i(f,t,n,r);for(var g=a/100*4096+.5|0,m=o<<8,p=t*n,d=0;d<p;d++)h=(s=c[d])-f[d],Math.abs(h)>=m&&(A=((l=(l=(l=s+(g*h+2048>>12))>65280?65280:l)<0?0:l)<<12)/(s=0!==s?s:1)|0,e[u=4*d]=e[u]*A+2048>>12,e[u+1]=e[u+1]*A+2048>>12,e[u+2]=e[u+2]*A+2048>>12)}}},{"glur/mono16":18}],11:[function(e,t,n){t.exports=function(e,t,n,i,a,r){if(!(0===i||a<.5)){a>2&&(a=2);var o=t*n,s=4*o,l=2*o,A=2*o,h=4*Math.max(t,n),u=0,c=s,f=c+l,g=f+A,m=g+A,p=m+h,d=this.__instance("unsharp_mask",s+l+2*A+h+8*4,{exp:Math.exp}),y=new Uint32Array(e.buffer);new Uint32Array(this.__memory.buffer).set(y);var v=d.exports.hsv_v16||d.exports._hsv_v16;v(u,c,t,n),(v=d.exports.blurMono16||d.exports._blurMono16)(c,f,g,m,p,t,n,a),(v=d.exports.unsharp||d.exports._unsharp)(u,u,c,f,t,n,i,r),y.set(new Uint32Array(this.__memory.buffer,0,o))}}},{}],12:[function(e,t,n){t.exports="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"},{}],13:[function(e,t,n){var i=100;function a(e,t){this.create=e,this.available=[],this.acquired={},this.lastId=1,this.timeoutId=0,this.idle=t||2e3}a.prototype.acquire=function(){var e,t=this;return 0!==this.available.length?e=this.available.pop():((e=this.create()).id=this.lastId++,e.release=function(){return t.release(e)}),this.acquired[e.id]=e,e},a.prototype.release=function(e){var t=this;delete this.acquired[e.id],e.lastUsed=Date.now(),this.available.push(e),0===this.timeoutId&&(this.timeoutId=setTimeout((function(){return t.gc()}),i))},a.prototype.gc=function(){var e=this,t=Date.now();this.available=this.available.filter((function(n){return!(t-n.lastUsed>e.idle&&(n.destroy(),1))})),0!==this.available.length?this.timeoutId=setTimeout((function(){return e.gc()}),i):this.timeoutId=0},t.exports=a},{}],14:[function(e,t,n){var i=2;t.exports=function(e,t,n,a,r,o){var s=n/e,l=a/t,A=(2*o+i+1)/r;if(A>.5)return[[n,a]];var h=Math.ceil(Math.log(Math.min(s,l))/Math.log(A));if(h<=1)return[[n,a]];for(var u=[],c=0;c<h;c++){var f=Math.round(Math.pow(Math.pow(e,h-c-1)*Math.pow(n,c+1),1/h)),g=Math.round(Math.pow(Math.pow(t,h-c-1)*Math.pow(a,c+1),1/h));u.push([f,g])}return u}},{}],15:[function(e,t,n){var i=1e-5;function a(e){var t=Math.round(e);return Math.abs(e-t)<i?t:Math.floor(e)}function r(e){var t=Math.round(e);return Math.abs(e-t)<i?t:Math.ceil(e)}t.exports=function(e){var t,n,i,o,s,l,A=e.toWidth/e.width,h=e.toHeight/e.height,u=a(e.srcTileSize*A)-2*e.destTileBorder,c=a(e.srcTileSize*h)-2*e.destTileBorder;if(u<1||c<1)throw new Error("Internal error in pica: target tile width/height is too small.");var f,g=[];for(o=0;o<e.toHeight;o+=c)for(i=0;i<e.toWidth;i+=u)(t=i-e.destTileBorder)<0&&(t=0),t+(s=i+u+e.destTileBorder-t)>=e.toWidth&&(s=e.toWidth-t),(n=o-e.destTileBorder)<0&&(n=0),n+(l=o+c+e.destTileBorder-n)>=e.toHeight&&(l=e.toHeight-n),f={toX:t,toY:n,toWidth:s,toHeight:l,toInnerX:i,toInnerY:o,toInnerWidth:u,toInnerHeight:c,offsetX:t/A-a(t/A),offsetY:n/h-a(n/h),scaleX:A,scaleY:h,x:a(t/A),y:a(n/h),width:r(s/A),height:r(l/h)},g.push(f);return g}},{}],16:[function(e,t,n){function i(e){return Object.prototype.toString.call(e)}t.exports.isCanvas=function(e){var t=i(e);return"[object HTMLCanvasElement]"===t||"[object OffscreenCanvas]"===t||"[object Canvas]"===t},t.exports.isImage=function(e){return"[object HTMLImageElement]"===i(e)},t.exports.isImageBitmap=function(e){return"[object ImageBitmap]"===i(e)},t.exports.limiter=function(e){var t=0,n=[];function i(){t<e&&n.length&&(t++,n.shift()())}return function(e){return new Promise((function(a,r){n.push((function(){e().then((function(e){a(e),t--,i()}),(function(e){r(e),t--,i()}))})),i()}))}},t.exports.cib_quality_name=function(e){switch(e){case 0:return"pixelated";case 1:return"low";case 2:return"medium"}return"high"},t.exports.cib_support=function(e){return Promise.resolve().then((function(){if("undefined"==typeof createImageBitmap)return!1;var t=e(100,100);return createImageBitmap(t,0,0,100,100,{resizeWidth:10,resizeHeight:10,resizeQuality:"high"}).then((function(e){var n=10===e.width;return e.close(),t=null,n}))}))["catch"]((function(){return!1}))},t.exports.worker_offscreen_canvas_support=function(){return new Promise((function(e,t){if("undefined"!=typeof OffscreenCanvas){var n=btoa("(".concat(function(e){"undefined"!=typeof createImageBitmap?Promise.resolve().then((function(){var e=new OffscreenCanvas(10,10);return e.getContext("2d").rect(0,0,1,1),createImageBitmap(e,0,0,1,1)})).then((function(){return e.postMessage(!0)}),(function(){return e.postMessage(!1)})):e.postMessage(!1)}.toString(),")(self);")),i=new Worker("data:text/javascript;base64,".concat(n));i.onmessage=function(t){return e(t.data)},i.onerror=t}else e(!1)})).then((function(e){return e}),(function(){return!1}))},t.exports.can_use_canvas=function(e){var t=!1;try{var n=e(2,1).getContext("2d"),i=n.createImageData(2,1);i.data[0]=12,i.data[1]=23,i.data[2]=34,i.data[3]=255,i.data[4]=45,i.data[5]=56,i.data[6]=67,i.data[7]=255,n.putImageData(i,0,0),i=null,12===(i=n.getImageData(0,0,2,1)).data[0]&&23===i.data[1]&&34===i.data[2]&&255===i.data[3]&&45===i.data[4]&&56===i.data[5]&&67===i.data[6]&&255===i.data[7]&&(t=!0)}catch(e){}return t},t.exports.cib_can_use_region=function(){return new Promise((function(e){if("undefined"!=typeof Image&&"undefined"!=typeof createImageBitmap){var t=new Image;t.src="data:image/jpeg;base64,"+"/9j/4QBiRXhpZgAATU0AKgAAAAgABQESAAMAAAABAAYAAAEaAAUAAAABAAAASgEbAAUAA"+"AABAAAAUgEoAAMAAAABAAIAAAITAAMAAAABAAEAAAAAAAAAAABIAAAAAQAAAEgAAAAB/9"+"sAQwAEAwMEAwMEBAMEBQQEBQYKBwYGBgYNCQoICg8NEBAPDQ8OERMYFBESFxIODxUcFRc"+"ZGRsbGxAUHR8dGh8YGhsa/9sAQwEEBQUGBQYMBwcMGhEPERoaGhoaGhoaGhoaGhoaGhoa"+"GhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoa/8IAEQgAAQACAwERAAIRAQMRA"+"f/EABQAAQAAAAAAAAAAAAAAAAAAAAf/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAA"+"IQAxAAAAF/P//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAQUCf//EABQRAQAAAAA"+"AAAAAAAAAAAAAAAD/2gAIAQMBAT8Bf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQIB"+"AT8Bf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEABj8Cf//EABQQAQAAAAAAAAAAA"+"AAAAAAAAAD/2gAIAQEAAT8hf//aAAwDAQACAAMAAAAQH//EABQRAQAAAAAAAAAAAAAAAA"+"AAAAD/2gAIAQMBAT8Qf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQIBAT8Qf//EABQ"+"QAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAT8Qf//Z",t.onload=function(){createImageBitmap(t,0,0,t.width,t.height).then((function(n){n.width===t.width&&n.height===t.height?e(!0):e(!1)}),(function(){return e(!1)}))},t.onerror=function(){return e(!1)}}else e(!1)}))}},{}],17:[function(e,t,n){t.exports=function(){var t,n=e("./mathlib");onmessage=function(e){var i=e.data.opts;if(!i.src&&i.srcBitmap){var a=new OffscreenCanvas(i.width,i.height),r=a.getContext("2d");r.drawImage(i.srcBitmap,0,0),i.src=r.getImageData(0,0,i.width,i.height).data,a.width=a.height=0,a=null,i.srcBitmap.close(),i.srcBitmap=null}t||(t=new n(e.data.features));var o=t.resizeAndUnsharp(i);postMessage({data:o},[o.buffer])}}},{"./mathlib":1}],18:[function(e,t,n){var i,a,r,o,s,l;function A(e,t,n,i,a,r){var o,s,l,A,h,u,c,f,g,m,p,d,y,v;for(g=0;g<r;g++){for(c=g,f=0,A=h=(o=e[u=g*a])*i[6],p=i[0],d=i[1],y=i[4],v=i[5],m=0;m<a;m++)l=(s=e[u])*p+o*d+A*y+h*v,h=A,A=l,o=s,n[f]=A,f++,u++;for(f--,c+=r*(a-1),A=h=(o=e[--u])*i[7],s=o,p=i[2],d=i[3],m=a-1;m>=0;m--)l=s*p+o*d+A*y+h*v,h=A,A=l,o=s,s=e[u],t[c]=n[f]+A,u--,f--,c-=r}}t.exports=function(e,t,n,h){if(h){var u=new Uint16Array(e.length),c=new Float32Array(Math.max(t,n)),f=function(e){e<.5&&(e=.5);var t=Math.exp(.726*.726)/e,n=Math.exp(-t),A=Math.exp(-2*t),h=(1-n)*(1-n)/(1+2*t*n-A);return i=h,a=h*(t-1)*n,r=h*(t+1)*n,o=-h*A,s=2*n,l=-A,new Float32Array([i,a,r,o,s,l,(i+a)/(1-s-l),(r+o)/(1-s-l)])}(h);A(e,u,c,f,t,n),A(u,e,c,f,n,t)}}},{}],19:[function(e,t,n){var i=e("object-assign"),a=e("./lib/base64decode"),r=e("./lib/wa_detect"),o={js:!0,wasm:!0};function s(e){if(!(this instanceof s))return new s(e);var t=i({},o,e||{});if(this.options=t,this.__cache={},this.__init_promise=null,this.__modules=t.modules||{},this.__memory=null,this.__wasm={},this.__isLE=1===new Uint32Array(new Uint8Array([1,0,0,0]).buffer)[0],!this.options.js&&!this.options.wasm)throw new Error('mathlib: at least "js" or "wasm" should be enabled')}s.prototype.has_wasm=r,s.prototype.use=function(e){return this.__modules[e.name]=e,this.options.wasm&&this.has_wasm()&&e.wasm_fn?this[e.name]=e.wasm_fn:this[e.name]=e.fn,this},s.prototype.init=function(){if(this.__init_promise)return this.__init_promise;if(!this.options.js&&this.options.wasm&&!this.has_wasm())return Promise.reject(new Error('mathlib: only "wasm" was enabled, but it\'s not supported'));var e=this;return this.__init_promise=Promise.all(Object.keys(e.__modules).map((function(t){var n=e.__modules[t];return e.options.wasm&&e.has_wasm()&&n.wasm_fn?e.__wasm[t]?null:WebAssembly.compile(e.__base64decode(n.wasm_src)).then((function(n){e.__wasm[t]=n})):null}))).then((function(){return e})),this.__init_promise},s.prototype.__base64decode=a,s.prototype.__reallocate=function(e){if(!this.__memory)return this.__memory=new WebAssembly.Memory({initial:Math.ceil(e/(64*1024))}),this.__memory;var t=this.__memory.buffer.byteLength;return t<e&&this.__memory.grow(Math.ceil((e-t)/(64*1024))),this.__memory},s.prototype.__instance=function(e,t,n){if(t&&this.__reallocate(t),!this.__wasm[e]){var a=this.__modules[e];this.__wasm[e]=new WebAssembly.Module(this.__base64decode(a.wasm_src))}if(!this.__cache[e]){var r={memoryBase:0,memory:this.__memory,tableBase:0,table:new WebAssembly.Table({initial:0,element:"anyfunc"})};this.__cache[e]=new WebAssembly.Instance(this.__wasm[e],{env:i(r,n||{})})}return this.__cache[e]},s.prototype.__align=function(e,t){var n=e%(t=t||8);return e+(n?t-n:0)},t.exports=s},{"./lib/base64decode":20,"./lib/wa_detect":21,"object-assign":22}],20:[function(e,t,n){var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";t.exports=function(e){for(var t=e.replace(/[\r\n=]/g,""),n=t.length,a=new Uint8Array(3*n>>2),r=0,o=0,s=0;s<n;s++)s%4==0&&s&&(a[o++]=r>>16&255,a[o++]=r>>8&255,a[o++]=255&r),r=r<<6|i.indexOf(t.charAt(s));var l=n%4*6;return 0===l?(a[o++]=r>>16&255,a[o++]=r>>8&255,a[o++]=255&r):18===l?(a[o++]=r>>10&255,a[o++]=r>>2&255):12===l&&(a[o++]=r>>4&255),a}},{}],21:[function(e,t,n){var i;t.exports=function(){if(void 0!==i)return i;if(i=!1,"undefined"==typeof WebAssembly)return i;try{var e=new Uint8Array([0,97,115,109,1,0,0,0,1,6,1,96,1,127,1,127,3,2,1,0,5,3,1,0,1,7,8,1,4,116,101,115,116,0,0,10,16,1,14,0,32,0,65,1,54,2,0,32,0,40,2,0,11]),t=new WebAssembly.Module(e);return 0!==new WebAssembly.Instance(t,{}).exports.test(4)&&(i=!0),i}catch(e){}return i}},{}],22:[function(e,t,n){var i=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable;function o(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}t.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var i={};return"abcdefghijklmnopqrst".split("").forEach((function(e){i[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},i)).join("")}catch(e){return!1}}()?Object.assign:function(e,t){for(var n,s,l=o(e),A=1;A<arguments.length;A++){for(var h in n=Object(arguments[A]))a.call(n,h)&&(l[h]=n[h]);if(i){s=i(n);for(var u=0;u<s.length;u++)r.call(n,s[u])&&(l[s[u]]=n[s[u]])}}return l}},{}],23:[function(e,t,n){var i=arguments[3],a=arguments[4],r=arguments[5],o=JSON.stringify;t.exports=function(e,t){for(var n,s=Object.keys(r),l=0,A=s.length;l<A;l++){var h=s[l],u=r[h].exports;if(u===e||u&&u.default===e){n=h;break}}if(!n){n=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var c={};for(l=0,A=s.length;l<A;l++)c[h=s[l]]=h;a[n]=["function(require,module,exports){"+e+"(self); }",c]}var f=Math.floor(Math.pow(16,8)*Math.random()).toString(16),g={};g[n]=n,a[f]=["function(require,module,exports){"+"var f = require("+o(n)+");"+"(f.default ? f.default : f)(self);"+"}",g];var m={};!function e(t){for(var n in m[t]=!0,a[t][1]){var i=a[t][1][n];m[i]||e(i)}}(f);var p="("+i+")({"+Object.keys(m).map((function(e){return o(e)+":["+a[e][0]+","+o(a[e][1])+"]"})).join(",")+"},{},["+o(f)+"])",d=window.URL||window.webkitURL||window.mozURL||window.msURL,y=new Blob([p],{type:"text/javascript"});if(t&&t.bare)return y;var v=d.createObjectURL(y),I=new Worker(v);return I.objectURL=v,I}},{}],"/index.js":[function(e,t,n){function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,a,r=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(i=n.next()).done)&&(r.push(i.value),!t||r.length!==t);o=!0);}catch(e){s=!0,a=e}finally{try{o||null==n["return"]||n["return"]()}finally{if(s)throw a}}return r}}(e,t)||function(e,t){if(e){if("string"==typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var r=e("object-assign"),o=e("webworkify"),s=e("./lib/mathlib"),l=e("./lib/pool"),A=e("./lib/utils"),h=e("./lib/worker"),u=e("./lib/stepper"),c=e("./lib/tiler"),f=e("./lib/mm_resize/resize_filter_info"),g={},m=!1;try{"undefined"!=typeof navigator&&navigator.userAgent&&(m=navigator.userAgent.indexOf("Safari")>=0)}catch(e){}var p=1;"undefined"!=typeof navigator&&(p=Math.min(navigator.hardwareConcurrency||1,4));var d={tile:1024,concurrency:p,features:["js","wasm","ww"],idle:2e3,createCanvas:function(e,t){var n=document.createElement("canvas");return n.width=e,n.height=t,n}},y={filter:"mks2013",unsharpAmount:0,unsharpRadius:0,unsharpThreshold:0},v=!1,I=!1,w=!1,C=!1,B=!1;function E(){return{value:o(h),destroy:function(){if(this.value.terminate(),"undefined"!=typeof window){var e=window.URL||window.webkitURL||window.mozURL||window.msURL;e&&e.revokeObjectURL&&this.value.objectURL&&e.revokeObjectURL(this.value.objectURL)}}}}function S(e){if(!(this instanceof S))return new S(e);this.options=r({},d,e||{});var t="lk_".concat(this.options.concurrency);this.__limit=g[t]||A.limiter(this.options.concurrency),g[t]||(g[t]=this.__limit),this.features={js:!1,wasm:!1,cib:!1,ww:!1},this.__workersPool=null,this.__requested_features=[],this.__mathlib=null}S.prototype.init=function(){var t=this;if(this.__initPromise)return this.__initPromise;if("undefined"!=typeof ImageData&&"undefined"!=typeof Uint8ClampedArray)try{new ImageData(new Uint8ClampedArray(400),10,10),v=!0}catch(e){}"undefined"!=typeof ImageBitmap&&(ImageBitmap.prototype&&ImageBitmap.prototype.close?I=!0:this.debug("ImageBitmap does not support .close(), disabled"));var n=this.options.features.slice();if(n.indexOf("all")>=0&&(n=["cib","wasm","js","ww"]),this.__requested_features=n,this.__mathlib=new s(n),n.indexOf("ww")>=0&&"undefined"!=typeof window&&"Worker"in window)try{e("webworkify")((function(){})).terminate(),this.features.ww=!0;var i="wp_".concat(JSON.stringify(this.options));g[i]?this.__workersPool=g[i]:(this.__workersPool=new l(E,this.options.idle),g[i]=this.__workersPool)}catch(e){}var a,o,h=this.__mathlib.init().then((function(e){r(t.features,e.features)}));a=I?A.cib_support(this.options.createCanvas).then((function(e){t.features.cib&&n.indexOf("cib")<0?t.debug("createImageBitmap() resize supported, but disabled by config"):n.indexOf("cib")>=0&&(t.features.cib=e)})):Promise.resolve(!1),w=A.can_use_canvas(this.options.createCanvas),o=(o=I&&v&&-1!==n.indexOf("ww")?A.worker_offscreen_canvas_support():Promise.resolve(!1)).then((function(e){C=e}));var u=A.cib_can_use_region().then((function(e){B=e}));return this.__initPromise=Promise.all([h,a,o,u]).then((function(){return t})),this.__initPromise},S.prototype.__invokeResize=function(e,t){var n=this;return t.__mathCache=t.__mathCache||{},Promise.resolve().then((function(){return n.features.ww?new Promise((function(i,a){var r=n.__workersPool.acquire();t.cancelToken&&t.cancelToken["catch"]((function(e){return a(e)})),r.value.onmessage=function(e){r.release(),e.data.err?a(e.data.err):i(e.data)};var o=[];e.src&&o.push(e.src.buffer),e.srcBitmap&&o.push(e.srcBitmap),r.value.postMessage({opts:e,features:n.__requested_features,preload:{wasm_nodule:n.__mathlib.__}},o)})):{data:n.__mathlib.resizeAndUnsharp(e,t.__mathCache)}}))},S.prototype.__extractTileData=function(e,t,n,i,a){if(this.features.ww&&C&&(A.isCanvas(t)||B))return this.debug("Create tile for OffscreenCanvas"),createImageBitmap(i.srcImageBitmap||t,e.x,e.y,e.width,e.height).then((function(e){return a.srcBitmap=e,a}));if(A.isCanvas(t))return i.srcCtx||(i.srcCtx=t.getContext("2d")),this.debug("Get tile pixel data"),a.src=i.srcCtx.getImageData(e.x,e.y,e.width,e.height).data,a;this.debug("Draw tile imageBitmap/image to temporary canvas");var r=this.options.createCanvas(e.width,e.height),o=r.getContext("2d");return o.globalCompositeOperation="copy",o.drawImage(i.srcImageBitmap||t,e.x,e.y,e.width,e.height,0,0,e.width,e.height),this.debug("Get tile pixel data"),a.src=o.getImageData(0,0,e.width,e.height).data,r.width=r.height=0,a},S.prototype.__landTileData=function(e,t,n){var i;if(this.debug("Convert raw rgba tile result to ImageData"),t.bitmap)return n.toCtx.drawImage(t.bitmap,e.toX,e.toY),null;if(v)i=new ImageData(new Uint8ClampedArray(t.data),e.toWidth,e.toHeight);else if((i=n.toCtx.createImageData(e.toWidth,e.toHeight)).data.set)i.data.set(t.data);else for(var a=i.data.length-1;a>=0;a--)i.data[a]=t.data[a];return this.debug("Draw tile"),m?n.toCtx.putImageData(i,e.toX,e.toY,e.toInnerX-e.toX,e.toInnerY-e.toY,e.toInnerWidth+1e-5,e.toInnerHeight+1e-5):n.toCtx.putImageData(i,e.toX,e.toY,e.toInnerX-e.toX,e.toInnerY-e.toY,e.toInnerWidth,e.toInnerHeight),null},S.prototype.__tileAndResize=function(e,t,n){var i=this,a={srcCtx:null,srcImageBitmap:null,isImageBitmapReused:!1,toCtx:null};return Promise.resolve().then((function(){return a.toCtx=t.getContext("2d"),A.isCanvas(e)?null:A.isImageBitmap(e)?(a.srcImageBitmap=e,a.isImageBitmapReused=!0,null):A.isImage(e)?I?(i.debug("Decode image via createImageBitmap"),createImageBitmap(e).then((function(e){a.srcImageBitmap=e}))["catch"]((function(e){return null}))):null:void console.log(`from=`,e)})).then((function(){if(n.canceled)return n.cancelToken;i.debug("Calculate tiles");var r=c({width:n.width,height:n.height,srcTileSize:i.options.tile,toWidth:n.toWidth,toHeight:n.toHeight,destTileBorder:n.__destTileBorder}).map((function(t){return function(t){return i.__limit((function(){if(n.canceled)return n.cancelToken;var r={width:t.width,height:t.height,toWidth:t.toWidth,toHeight:t.toHeight,scaleX:t.scaleX,scaleY:t.scaleY,offsetX:t.offsetX,offsetY:t.offsetY,filter:n.filter,unsharpAmount:n.unsharpAmount,unsharpRadius:n.unsharpRadius,unsharpThreshold:n.unsharpThreshold};return i.debug("Invoke resize math"),Promise.resolve(r).then((function(r){return i.__extractTileData(t,e,n,a,r)})).then((function(e){return i.debug("Invoke resize math"),i.__invokeResize(e,n)})).then((function(e){return n.canceled?n.cancelToken:(a.srcImageData=null,i.__landTileData(t,e,a))}))}))}(t)}));function o(e){e.srcImageBitmap&&(e.isImageBitmapReused||e.srcImageBitmap.close(),e.srcImageBitmap=null)}return i.debug("Process tiles"),Promise.all(r).then((function(){return i.debug("Finished!"),o(a),t}),(function(e){throw o(a),e}))}))},S.prototype.__processStages=function(e,t,n,a){var o=this;if(a.canceled)return a.cancelToken;var s,l,A=i(e.shift(),2),h=A[0],u=A[1],c=0===e.length;return s=c||f.q2f.indexOf(a.filter)<0?a.filter:"box"===a.filter?"box":"hamming",a=r({},a,{toWidth:h,toHeight:u,filter:s}),c||(l=this.options.createCanvas(h,u)),this.__tileAndResize(t,c?n:l,a).then((function(){return c?n:(a.width=h,a.height=u,o.__processStages(e,l,n,a))})).then((function(e){return l&&(l.width=l.height=0),e}))},S.prototype.__resizeViaCreateImageBitmap=function(e,t,n){var i=this,a=t.getContext("2d");return this.debug("Resize via createImageBitmap()"),createImageBitmap(e,{resizeWidth:n.toWidth,resizeHeight:n.toHeight,resizeQuality:A.cib_quality_name(f.f2q[n.filter])}).then((function(e){if(n.canceled)return n.cancelToken;if(!n.unsharpAmount)return a.drawImage(e,0,0),e.close(),a=null,i.debug("Finished!"),t;i.debug("Unsharp result");var r=i.options.createCanvas(n.toWidth,n.toHeight),o=r.getContext("2d");o.drawImage(e,0,0),e.close();var s=o.getImageData(0,0,n.toWidth,n.toHeight);return i.__mathlib.unsharp_mask(s.data,n.toWidth,n.toHeight,n.unsharpAmount,n.unsharpRadius,n.unsharpThreshold),a.putImageData(s,0,0),r.width=r.height=0,s=o=r=a=null,i.debug("Finished!"),t}))},S.prototype.resize=function(e,t,n){var i=this;this.debug("Start resize...");var a=r({},y);if(isNaN(n)?n&&(a=r(a,n)):a=r(a,{quality:n}),a.toWidth=t.width,a.toHeight=t.height,a.width=e.naturalWidth||e.width,a.height=e.naturalHeight||e.height,Object.prototype.hasOwnProperty.call(a,"quality")){if(a.quality<0||a.quality>3)throw new Error("Pica: .quality should be [0..3], got ".concat(a.quality));a.filter=f.q2f[a.quality]}return 0===t.width||0===t.height?Promise.reject(new Error("Invalid output size: ".concat(t.width,"x").concat(t.height))):(a.unsharpRadius>2&&(a.unsharpRadius=2),a.canceled=!1,a.cancelToken&&(a.cancelToken=a.cancelToken.then((function(e){throw a.canceled=!0,e}),(function(e){throw a.canceled=!0,e}))),a.__destTileBorder=Math.ceil(Math.max(3,2.5*a.unsharpRadius|0)),this.init().then((function(){if(a.canceled)return a.cancelToken;if(i.features.cib){if(f.q2f.indexOf(a.filter)>=0)return i.__resizeViaCreateImageBitmap(e,t,a);i.debug("cib is enabled, but not supports provided filter, fallback to manual math")}if(!w){var n=new Error("Pica: cannot use getImageData on canvas, "+"make sure fingerprinting protection isn't enabled");throw n.code="ERR_GET_IMAGE_DATA",n}var r=u(a.width,a.height,a.toWidth,a.toHeight,i.options.tile,a.__destTileBorder);return i.__processStages(r,e,t,a)})))},S.prototype.resizeBuffer=function(e){var t=this,n=r({},y,e);if(Object.prototype.hasOwnProperty.call(n,"quality")){if(n.quality<0||n.quality>3)throw new Error("Pica: .quality should be [0..3], got ".concat(n.quality));n.filter=f.q2f[n.quality]}return this.init().then((function(){return t.__mathlib.resizeAndUnsharp(n)}))},S.prototype.toBlob=function(e,t,n){return t=t||"image/png",new Promise((function(i){if(e.toBlob)e.toBlob((function(e){return i(e)}),t,n);else if(e.convertToBlob)i(e.convertToBlob({type:t,quality:n}));else{for(var a=atob(e.toDataURL(t,n).split(",")[1]),r=a.length,o=new Uint8Array(r),s=0;s<r;s++)o[s]=a.charCodeAt(s);i(new Blob([o],{type:t}))}}))},S.prototype.debug=function(){},t.exports=S},{"./lib/mathlib":1,"./lib/mm_resize/resize_filter_info":7,"./lib/pool":13,"./lib/stepper":14,"./lib/tiler":15,"./lib/utils":16,"./lib/worker":17,"object-assign":22,webworkify:23}]},{},[])("/index.js")})),f="square",g="to",m="MANIPULATION",p="LOADER",d="FILTER",y="DRAW";function v(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=Object.assign({pica:{},picaInit:{}},i);return a.picaInit.features||(a.picaInit.features=["js"]),function(i){return new Promise((function(r,o){var s=null,l=document.createElement("canvas"),A=0,h=i.width,u=i.height,m=0,p=0;if(n===f)m=u*(A=h<u?e/h:t/u),p=h*A;else if(n===g){var d=h/e,y=u/t;d>y?(m=Math.round(u/d),p=e):(p=Math.round(h/y),m=t)}else o(new Error("Unknown resize type"));l.width=p,l.height=m,new c(a.picaInit).resize(i,l,a.pica).then((function(e){if(n===f){var t=0,i=0;p<m?(i=(m-p)/2,m=p):(t=(p-m)/2,p=m);var a=document.createElement("canvas"),o=a.getContext("2d");a.width=p,a.height=m,o.drawImage(e,t,i,p,m,0,0,p,m),s=a}else s=e;r(s)}))}))}}function I(e){return e*(Math.PI/180)}function w(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.padding,i=void 0===n?0:n,a=t.bgColor,r=void 0===a?"white":a;return function(t){return new Promise((function(n,a){var o=document.createElement("canvas"),s=0;e<0&&(e=360+e),s=e>=0&&e<=90?90-e:270-e;var l=I(e),A=I(s),h=I(e),u={cosAngle:Math.cos(h),cosCalcAngle:Math.cos(A),sinAngle:Math.sin(h),sinCalcAngle:Math.sin(A)};for(var c in u)u[c]<0&&(u[c]=-1*u[c]);o.width=t.width*u.cosAngle+t.height*u.cosCalcAngle+i,o.height=t.width*u.sinAngle+t.height*u.sinCalcAngle+i;var f=o.getContext("2d");r&&(f.beginPath(),f.rect(0,0,o.width,o.height),f.fillStyle=r,f.fill(),f.save()),f.save(),f.translate(o.width/2,o.height/2),f.rotate(l),f.drawImage(t,-t.width/2,-t.height/2),f.restore(),n(o)}))}}function C(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.bgColor,a=void 0===i?"white":i;return function(n){return new Promise((function(i,r){var o=document.createElement("canvas");o.width=e,o.height=t;var s=o.getContext("2d"),l=n.width,A=n.height;a&&(s.beginPath(),s.rect(0,0,e,t),s.fillStyle=a,s.fill(),s.save());var h=0,u=0;l<e&&(h=(e-l)/2),A<t&&(u=(t-A)/2),s.drawImage(n,0,0,l,A,h,u,l,A),i(o)}))}}function B(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.padding,i=void 0===n?4:n,a=t.bgColor,r=void 0===a?"white":a;return function(t){return new Promise((function(n,a){var o=document.createElement("canvas");o.width=e,o.height=e;var s=o.getContext("2d");s.beginPath(),s.rect(0,0,e,e),s.fillStyle=r,s.fill(),s.save();var l=e-i,A=Math.round(l/2);s.beginPath(),s.arc(A+i/2,A+i/2,A-i/2,0,2*Math.PI,!0),s.closePath(),s.clip(),s.drawImage(t,0,0,l,l),s.restore(),n(o)}))}}function E(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.rQ,n=void 0===t?.34:t,i=e.gQ,a=void 0===i?.5:i,r=e.bQ,o=void 0===r?.16:r;return function(e){return new Promise((function(t,i){var r=document.createElement("canvas");r.width=e.width,r.height=e.height;var s=r.getContext("2d");s.drawImage(e,0,0);for(var l=s.getImageData(0,0,r.width,r.height),A=l.data,h=0;h<A.length;h+=4){var u=n*A[h]+a*A[h+1]+o*A[h+2];A[h]=u,A[h+1]=u,A[h+2]=u}s.putImageData(l,0,0),t(r)}))}}function S(e){return function(t){return new Promise((function(n,i){var a=document.createElement("canvas"),r=a.getContext("2d");a.width=t.width,a.height=t.height;var o=t.width*e,s=t.height*e;b(r),r.drawImage(t,0,0,o,s),b(r),r.drawImage(a,0,0,o,s,0,0,t.width,t.height),n(a)}))}}function b(e){e.webkitImageSmoothingEnabled=!1,e.mozImageSmoothingEnabled=!1,e.msImageSmoothingEnabled=!1,e.imageSmoothingEnabled=!1}function _(e){return(_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var Q=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],P=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function x(e,t,n,i,a,r){if(!(isNaN(r)||r<1)){r|=0;var o=function(e,t,n,i,a){if("string"==typeof e&&(e=document.getElementById(e)),!e||"object"!==_(e)||!("getContext"in e))throw new TypeError("Expecting canvas with `getContext` method in processCanvasRGB(A) calls!");var r=e.getContext("2d");try{return r.getImageData(t,n,i,a)}catch(e){throw new Error("unable to access image data: "+e)}}(e,t,n,i,a);o=function(e,t,n,i,a,r){var o,s,l,A,h,u,c,f,g,m,p,d,y,v,I,w,C,B,E,S,b,_,x,k,D,L=e.data,M=2*r+1,G=i-1,T=a-1,F=r+1,O=F*(F+1)/2,U=new R,j=U;for(l=1;l<M;l++)j=j.next=new R,l===F&&(D=j);j.next=U;var H=null,N=null;c=u=0;var z=Q[r],q=P[r];for(s=0;s<a;s++){for(w=C=B=E=f=g=m=p=0,d=F*(S=L[u]),y=F*(b=L[u+1]),v=F*(_=L[u+2]),I=F*(x=L[u+3]),f+=O*S,g+=O*b,m+=O*_,p+=O*x,j=U,l=0;l<F;l++)j.r=S,j.g=b,j.b=_,j.a=x,j=j.next;for(l=1;l<F;l++)A=u+((G<l?G:l)<<2),f+=(j.r=S=L[A])*(k=F-l),g+=(j.g=b=L[A+1])*k,m+=(j.b=_=L[A+2])*k,p+=(j.a=x=L[A+3])*k,w+=S,C+=b,B+=_,E+=x,j=j.next;for(H=U,N=D,o=0;o<i;o++)L[u+3]=x=p*z>>q,0!==x?(x=255/x,L[u]=(f*z>>q)*x,L[u+1]=(g*z>>q)*x,L[u+2]=(m*z>>q)*x):L[u]=L[u+1]=L[u+2]=0,f-=d,g-=y,m-=v,p-=I,d-=H.r,y-=H.g,v-=H.b,I-=H.a,A=c+((A=o+r+1)<G?A:G)<<2,w+=H.r=L[A],C+=H.g=L[A+1],B+=H.b=L[A+2],E+=H.a=L[A+3],f+=w,g+=C,m+=B,p+=E,H=H.next,d+=S=N.r,y+=b=N.g,v+=_=N.b,I+=x=N.a,w-=S,C-=b,B-=_,E-=x,N=N.next,u+=4;c+=i}for(o=0;o<i;o++){for(C=B=E=w=g=m=p=f=0,d=F*(S=L[u=o<<2]),y=F*(b=L[u+1]),v=F*(_=L[u+2]),I=F*(x=L[u+3]),f+=O*S,g+=O*b,m+=O*_,p+=O*x,j=U,l=0;l<F;l++)j.r=S,j.g=b,j.b=_,j.a=x,j=j.next;for(h=i,l=1;l<=r;l++)u=h+o<<2,f+=(j.r=S=L[u])*(k=F-l),g+=(j.g=b=L[u+1])*k,m+=(j.b=_=L[u+2])*k,p+=(j.a=x=L[u+3])*k,w+=S,C+=b,B+=_,E+=x,j=j.next,l<T&&(h+=i);for(u=o,H=U,N=D,s=0;s<a;s++)L[(A=u<<2)+3]=x=p*z>>q,x>0?(x=255/x,L[A]=(f*z>>q)*x,L[A+1]=(g*z>>q)*x,L[A+2]=(m*z>>q)*x):L[A]=L[A+1]=L[A+2]=0,f-=d,g-=y,m-=v,p-=I,d-=H.r,y-=H.g,v-=H.b,I-=H.a,A=o+((A=s+F)<T?A:T)*i<<2,f+=w+=H.r=L[A],g+=C+=H.g=L[A+1],m+=B+=H.b=L[A+2],p+=E+=H.a=L[A+3],H=H.next,d+=S=N.r,y+=b=N.g,v+=_=N.b,I+=x=N.a,w-=S,C-=b,B-=_,E-=x,N=N.next,u+=i}return e}(o,0,0,i,a,r),e.getContext("2d").putImageData(o,t,n)}}var R=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.r=0,this.g=0,this.b=0,this.a=0,this.next=null};function k(e){return function(t){return new Promise((function(n,i){var a=document.createElement("canvas");a.width=t.width,a.height=t.height,a.getContext("2d").drawImage(t,0,0),x(a,0,0,t.width,t.height,e),n(a)}))}}function D(e,t,n,i){return new Promise((function(a,r){e.toBlob((function(e){var i=new Blob([e],{type:n});i.name=function(e,t){var n=e.split("."),i="jpg";return t.indexOf("png")>-1?i="png":t.indexOf("webp")>-1&&(i="webp"),n.pop(),n.push(i),n.join(".")}(t,n),a(i)}),n,i)}))}function L(e,t,n){return new Promise((function(i,a){i(e.toDataURL(t,n))}))}var M=function(e){if(Array.isArray(e))return e};var G=function(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var n=[],i=!0,a=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);i=!0);}catch(e){a=!0,r=e}finally{try{i||null==s["return"]||s["return"]()}finally{if(a)throw r}}return n}};var T=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")};var F=function(e,t){return M(e)||G(e,t)||T()};function O(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(e.length<1)throw new Error("We need points");for(var t=[],n=0;n<e.length;n++)if(Array.isArray(e[n]))t.push(e[n]);else{var i=t.length-1;-1===i||t[i]&&2===t[i].length?t.push([e[n]]):t[i].push(e[n])}return t}function U(e,t,n){return function(i){return new Promise((function(a,r){var o=O(e),s=i.getContext("2d");s.save();var l=F(o[0],2),A=l[0],h=l[1];s.moveTo(A,h);for(var u=1;u<o.length;u++){var c=F(o[u],2),f=c[0],g=c[1];s.lineTo(f,g)}s.strokeStyle=t,s.lineWidth=n,s.stroke(),s.restore(),a(i)}))}}function j(e,t,n,i){return function(a){return new Promise((function(r,o){var s=O(e),l=a.getContext("2d");l.save(),l.beginPath();var A=F(s[0],2),h=A[0],u=A[1];l.moveTo(h,u);for(var c=1;c<s.length;c++){var f=F(s[c],2),g=f[0],m=f[1];l.lineTo(g,m)}l.closePath(),l.fillStyle=t,l.fill(),l.strokeStyle=n,l.lineWidth=i,l.stroke(),l.restore(),r(a)}))}}function H(e,t,n,i){return function(a){return new Promise((function(r,o){var s=O(e);if(s.length<2)throw new Error("Need points sequence of [[left, bottom], [right, top]] or [left, bottom, right, top]");var l=F(s[0],2),A=l[0],h=l[1],u=F(s[1],2),c=u[0],f=u[1],g=a.getContext("2d");g.save(),t&&g.beginPath(),g.moveTo(A,h),g.lineTo(A,f),g.lineTo(c,f),g.lineTo(c,h),g.lineTo(A,h),t&&(g.closePath(),g.fillStyle=t,g.fill()),n&&(g.strokeStyle=n,g.lineWidth=i,g.stroke()),g.restore(),r(a)}))}}function N(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=i.font,o=void 0===r?"helvetica":r,s=i.fontSize,l=void 0===s?null:s,A=i.fill,h=void 0===A?null:A,u=i.fillPadding,c=void 0===u?null:u,f=i.rotateAngle,g=void 0===f?null:f;return function(i){return new Promise(function(){var r=a(n.mark((function a(r,s){var A,u,f,m,p,d,y,v,I,w,C,B,E,S;return n.wrap((function(n){for(;1;)switch(n.prev=n.next){case 0:if(A=0,u=0,(f=document.createElement("canvas")).width=i.width,f.height=i.height,m=f.getContext("2d"),g&&(p=g*Math.PI/180,m.rotate(p)),l&&(A=l.indexOf("%")>-1?Math.floor(f.height*(parseFloat(l)/100)):parseFloat(l),o="".concat(A,"px ").concat(o).trim()),c&&(u=c.indexOf("%")>-1?Math.floor(f.height*(parseFloat(c)/100)):parseFloat(c)),!h){n.next=20;break}return m.save(),o&&(m.font=o),d=F(e,2),y=d[0],v=d[1],I=parseInt(m.font),w=m.measureText(t),C=w.width,"actualBoundingBoxAscent"in w&&(I=w.actualBoundingBoxAscent-w.actualBoundingBoxDescent),m.restore(),n.next=20,H([y-u,v+u,y+C+u,v-I-u],h,null)(f);case 20:m.save(),o&&(m.font=o),B=F(e,2),E=B[0],S=B[1],m.fillText(t,E,S),m.restore(),i.getContext("2d").drawImage(f,0,0),r(i);case 28:case"end":return n.stop()}}),a)})));return function(e,t){return r.apply(this,arguments)}}())}}function z(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,i=[],a=0;a<e.length;a++)i[a]=[q(e[a][0],t),q(e[a][1],n)];return i}function q(e,t){return e.toString().indexOf("%")>-1?Math.floor(t*(parseFloat(e)/100)):e}function W(e,t){var n=document.createElement("canvas");return n.width=e,n.height=t,n.getContext("2d")}function Y(e,t,n){for(var i=F(e,4),a=F(i[0],2),r=a[0],o=a[1],s=F(i[1],2),l=s[0],A=s[1],h=F(i[2],2),u=h[0],c=h[1],f=F(i[3],2),g=f[0],m=f[1],p=[Math.sqrt(Math.pow(r-l,2)+Math.pow(o-A,2)),Math.sqrt(Math.pow(l-u,2)+Math.pow(A-c,2)),Math.sqrt(Math.pow(u-g,2)+Math.pow(c-m,2)),Math.sqrt(Math.pow(g-r,2)+Math.pow(m-o,2))],d=0,y=0,v=0,I=0;I<4;I++){var w=0;(w=I%2?p[I]/t:p[I]/n)>y&&(d=I,y=w),0===p[I]&&v++}return v>1?0:d}function J(e,t){var n=t.ctxTransformed,i=t.sideSize,a=t.otherSizeSize,r=t.ctxOut,o=t.coverStep,s=t.step,l=F(e,4),A=F(l[0],2),h=A[0],u=A[1],c=F(l[1],2),f=c[0],g=c[1],m=F(l[2],2),p=m[0],d=m[1],y=F(l[3],2),v=y[0],I=y[1],w=W(a,o);w.globalCompositeOperation="copy";for(var C=0;C<i;C+=s){var B=C/i,E=h+(v-h)*B,S=u+(I-u)*B,b=f+(p-f)*B,_=g+(d-g)*B,Q=Math.atan((_-S)/(b-E)),P=Math.sqrt(Math.pow(b-E,2)+Math.pow(_-S,2))/a;w.setTransform(1,0,0,1,0,-C),w.drawImage(r.canvas,0,0),n.translate(E,S),n.rotate(Q),n.scale(P,P),n.drawImage(w.canvas,0,0),n.setTransform(1,0,0,1,0,0)}}function X(e,t){e.beginPath(),e.moveTo(t[0][0],t[0][1]);for(var n=1;n<t.length;n++)e.lineTo(t[n][0],t[n][1]);e.closePath(),e.globalCompositeOperation="destination-in",e.fill(),e.globalCompositeOperation="source-over"}var Z=function(){function e(){r(this,e),this._tasks=[],this._canvas=null,this._loadedCanvas=null,this._lastCanvas=null,this._fileName=null,this._exif={}}var t;return s(e,[{key:"loadBlob",value:function(e,t){return this._addToTask(p,function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.fixOrientation,i=void 0!==n&&n,a=t.readExif,r=void 0!==a&&a;return function(){return new Promise((function(t,n){var a=document.createElement("img"),o=new FileReader,s={};o.onload=function(e){s=i||r?A(e.target.result):{},a.src=e.target.result},o.onerror=function(){n(new Error("Image read error"))},a.onload=function(){var n=null;i&&(n=s["0th"]?s["0th"]["Orientation"]:null);var r=h(a,n);t({canvas:r,fileName:e.name,exif:s})},a.onerror=function(){n(new Error("Invalid image"))},o.readAsDataURL(e)}))}}(e,t)),this}},{key:"loadCanvas",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"canvas.png";return this._addToTask(p,u(e,t)),this}},{key:"_imageResize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:200,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this._addToTask(m,v(e,t,n,i)),this}},{key:"toSquare",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:150,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this._imageResize(e,e,f,t)}},{key:"crop",value:function(e,t,n,i){return this._addToTask(m,function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return function(a){return new Promise((function(r,o){var s,l,A=a.width,h=a.height;l=i||(h-t)/2,s=n||(A-e)/2;var u=document.createElement("canvas"),c=u.getContext("2d");u.width=e,u.height=t,c.drawImage(a,s,l,e,t,0,0,e,t),r(u)}))}}(e,t,n,i)),this}},{key:"resize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:200,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._imageResize(e,t,g,n)}},{key:"rotate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this._addToTask(m,w(e,t)),this}},{key:"toGrayscale",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._addToTask(d,E(e)),this}},{key:"pixelize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.2;return this._addToTask(d,S(e)),this}},{key:"gaussianBlur",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;return this._addToTask(d,k(e)),this}},{key:"centerInRectangle",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:200,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._imageResize(e,t,g,n),this._addToTask(m,C(e,t,n)),this}},{key:"toCircle",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:150,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this._imageResize(e,e,f,t),this._addToTask(m,B(e,t)),this}},{key:"_runTasks",value:(t=a(n.mark((function e(){var t,i;return n.wrap((function(e){for(;1;)switch(e.prev=e.next){case 0:this._canvas=null,t=0;case 2:if(!(t<this._tasks.length)){e.next=20;break}if(this._tasks[t].type!==p){e.next=12;break}return e.next=6,this._tasks[t].func();case 6:i=e.sent,this._loadedCanvas=i.canvas,i.fileName&&(this._fileName=i.fileName),i.exif&&(this._exif=i.exif),e.next=17;break;case 12:if(null!==this._canvas||null!==this._loadedCanvas){e.next=14;break}throw new Error("use loadBlob first");case 14:return e.next=16,this._tasks[t].func(this._canvas||this._loadedCanvas);case 16:this._canvas=e.sent;case 17:t++,e.next=2;break;case 20:this._cleanTasks();case 21:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"_addToTask",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"manipulation",t=arguments.length>1?arguments[1]:void 0;this._tasks.push({type:e,func:t})}},{key:"_cleanTasks",value:function(){this._tasks=[],null!==this._canvas&&(this._lastCanvas=this._canvas)}},{key:"getCanvas",value:function(){return this._canvas||this._lastCanvas}},{key:"getFileName",value:function(){return this._fileName}},{key:"getExif",value:function(){return this._exif}},{key:"setFileName",value:function(e){this._fileName=e}},{key:"saveAsBlob",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"image/jpeg",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"1.0";return this._runTasks().then((function(){return D(e.getCanvas(),e.getFileName(),t,n)}))}},{key:"saveAsCanvas",value:function(){var e=this;return this._runTasks().then((function(){return t=e.getCanvas(),Promise.resolve(t);var t}))}},{key:"saveAsImage",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"image/jpeg",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"1.0";return this._runTasks().then((function(){return L(e.getCanvas(),t,n)}))}},{key:"drawLine",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"green",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:6;return this._addToTask(y,U(e,t,n)),this}},{key:"drawPolygon",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"green",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"red",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:6;return this._addToTask(y,j(e,t,n,i)),this}},{key:"drawRectangle",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"red",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:6;return this._addToTask(y,H(e,t,n,i)),this}},{key:"drawText",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._addToTask(y,N(e,t,n)),this}},{key:"perspective",value:function(e){return this._addToTask(m,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t){return new Promise((function(n,i){var a=t.getContext("2d"),r=t.width,o=t.height,s=e.xy0,l=void 0===s?["0%","0%"]:s,A=e.xy1,h=void 0===A?["100%","0%"]:A,u=e.xy2,c=void 0===u?["100%","100%"]:u,f=e.xy3,g=z([l,h,c,void 0===f?["0%","100%"]:f],r,o),m=W(r,o);m.drawImage(t,0,0,r,o);var p=W(r,o),d=Y(g,r,o),y=2,v=5*y;p.clearRect(0,0,p.canvas.width,p.canvas.height),d%2==0?J(g,{ctxTransformed:p,sideSize:o,otherSizeSize:r,ctxOut:m,coverStep:v,step:y}):d%2==1&&J(g,{ctxTransformed:p,sideSize:r,otherSizeSize:o,ctxOut:m,coverStep:v,step:y}),a.save(),a.drawImage(p.canvas,0,0),X(a,g),a.restore(),n(a.canvas)}))}}(e)),this}}]),e}();t((function(e){!function(t){var n=t.HTMLCanvasElement&&t.HTMLCanvasElement.prototype,i=t.Blob&&function(){try{return Boolean(new Blob)}catch(e){return!1}}(),a=i&&t.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(e){return!1}}(),r=t.BlobBuilder||t.WebKitBlobBuilder||t.MozBlobBuilder||t.MSBlobBuilder,o=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,s=(i||r)&&t.atob&&t.ArrayBuffer&&t.Uint8Array&&function(e){var t,n,s,l,A,h,u,c,f;if(!(t=e.match(o)))throw new Error("invalid data URI");for(n=t[2]?t[1]:"text/plain"+(t[3]||";charset=US-ASCII"),s=!!t[4],l=e.slice(t[0].length),A=s?atob(l):decodeURIComponent(l),h=new ArrayBuffer(A.length),u=new Uint8Array(h),c=0;c<A.length;c+=1)u[c]=A.charCodeAt(c);return i?new Blob([a?u:h],{type:n}):((f=new r).append(h),f.getBlob(n))};t.HTMLCanvasElement&&!n.toBlob&&(n.mozGetAsFile?n.toBlob=function(e,t,i){var a=this;setTimeout((function(){i&&n.toDataURL&&s?e(s(a.toDataURL(t,i))):e(a.mozGetAsFile("blob",t))}))}:n.toDataURL&&s&&(n.toBlob=function(e,t,n){var i=this;setTimeout((function(){e(s(i.toDataURL(t,n)))}))})),e.exports?e.exports=s:t.dataURLtoBlob=s}(window)}));return"undefined"!=typeof window&&(window.BrowserImageManipulation=Z),Z}));
